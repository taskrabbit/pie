!function(t){var e=t.pie={apps:{},array:{},browser:{},date:{},dom:{},fn:{},math:{},object:{},string:{},mixins:{},pieId:1,guid:function(){var t,e;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){return t=16*Math.random()|0,e="x"===n?t:3&t|8,e.toString(16)})},ns:function(n,i){return i=i||t,e.object.getPath(i,n)||e.object.setPath(i,n,{})},qs:function(){return document.querySelector.apply(document,arguments)},qsa:function(){return document.querySelectorAll.apply(document,arguments)},setUid:function(t){return t.pieId=t.pieId||e.unique()},unique:function(){return String(e.pieId++)},util:function(){var t={};return t.a=e.array,t.b=e.browser,t.d=e.date,t.$=e.dom,t.fn=e.fn,t.m=e.math,t.o=e.object,t.s=e.string,t.x=e.mixins,t.guid=e.guid,t.ns=e.ns,t.qs=e.qs,t.qsa=e.qsa,t.setUid=e.setUid,t.unique=e.unique,t},_debugArgs:function(t){return["%c[pie] %c"+t,"color: orange; font-weight: bold;","color: inherit; font-weight: inherit;"]}};e.array.areAll=function(t,n){t=e.array.from(t);for(var i=0;i<t.length;i++)if(!e.object.getValue(t[i],n))return!1;return!0},e.array.areAny=function(t,n){t=e.array.from(t);for(var i=0;i<t.length;i++)if(e.object.getValue(t[i],n))return!0;return!1},e.array.avg=function(t){t=e.array.from(t);var n=e.array.sum(t),i=t.length;return i?n/i:0},e.array.change=function(){var t=e.array.from(arguments),n=t.shift();return t.forEach(function(t){n=e.array[t](n)}),n},e.array.compact=function(t,n){return t=e.array.from(t),t.filter(function(t){return n?!!t:null!=t})},e.array.count=function(t,n){var i=0;return e.array.from(t).forEach(function(t){e.object.getValue(t,n)&&i++}),i},e.array.detect=function(t,n){t=e.array.from(t);for(var i=0,r=t.length;r>i;i++)if(e.object.getValue(t[i],n))return t[i]},e.array.detectLast=function(t,n){t=e.array.from(t);for(var i=t.length-1,r=0;i>=r;i--)if(e.object.getValue(t[i],n))return t[i]},e.array.dup=function(t){return e.array.from(t).slice(0)},e.array.each=function(t,n){return e.array._each(t,n,!0,"forEach")},e.array._each=function(t,n,i,r){var o;return o=e.object.isFunction(n)?n:function(t){var r=t[n];return i&&e.object.isFunction(r)?r.apply(t):r},e.array.from(t)[r](function(t){return o(t)})},e.array.filter=function(t,n){return e.array.from(t).filter(function(t){return e.object.getValue(t,n)})},e.array.flatten=function(t,n,i){return i=i||[],Array.isArray(t)&&-1!==n?(null!=n&&n--,t.forEach(function(t){e.array.flatten(t,n,i)})):i.push(t),i},e.array.from=function(t){return Array.isArray(t)?t:e.object.isArguments(t)||e.object.instanceOf(t,"NodeList")||e.object.instanceOf(t,"HTMLCollection")?Array.prototype.slice.call(t,0):e.array.compact([t],!1)},e.array.get=function(t,n,i){return t=e.array.from(t),0>n&&(n+=t.length),void 0!==i?(0>i&&(i+=t.length),t.slice(n,i+1)):t[n]},e.array.grep=function(t,n){return e.array.from(t).filter(function(t){return n.test(String(t))})},e.array.groupBy=function(t,n){var i,r={};return e.array.from(t).forEach(function(t){i=e.object.getValue(t,n),null!=i&&(r[i]=r[i]||[],r[i].push(t))}),r},e.array.hasAll=function(){var t,n=e.array.from(arguments[0]),i=e.array.get(arguments,1,-1);for(i=e.array.flatten(i),t=0;t<i.length;t++)if(!~n.indexOf(i[t]))return!1;return!0},e.array.hasAny=function(){var t,n=e.array.from(arguments[0]),i=e.array.get(arguments,1,-1);for(i=e.array.flatten(i),t=0;t<i.length;t++)if(~n.indexOf(i[t]))return!0;return!i.length},e.array.indexOf=function(t,n){t=e.array.from(t);for(var i=0,r=t.length;r>i;i++)if(e.object.getValue(t[i],n))return i;return-1},e.array.intersect=function(t,n){return n=e.array.from(n),e.array.from(t).filter(function(t){return~n.indexOf(t)})},e.array.last=function(t){return t=t&&e.array.from(t),t&&t.length?t[t.length-1]:void 0},e.array.map=function(t,n,i){return e.array._each(t,n,i,"map")},e.array.partition=function(){var t=[],n=e.array.from(arguments),i=e.array.from(n.shift());return n.forEach(function(n,r){t[r]=[],t[r+1]=t[r+1]||[],i.forEach(function(i){e.object.getValue(i,n)?t[r].push(i):t[r+1].push(i)}),i=e.array.dup(t[r+1])}),t},e.array.partitionAt=function(t,n){var i=[],r=[],o=!0;return e.array.from(t).forEach(function(t){o&&e.object.getValue(t,n)&&(o=!1),(o?i:r).push(t)}),[i,r]},e.array.remove=function(t,n){t=e.array.from(t);for(var i;~(i=t.indexOf(n));)t.splice(i,1);return t},e.array.subtract=function(t,n){return e.array.from(t).filter(function(t){return!~n.indexOf(t)})},e.array.sum=function(t){return e.array.from(t).reduce(function(t,e){return t+parseFloat(e)},0)},e.array.sortBy=function(t,n){var i,r;return e.array.from(t).sort(function(t,o){return i=e.object.getValue(t,n),r=e.object.getValue(o,n),i===r?0:r>i?-1:1})},e.array.toSentence=function(t,n){if(t=e.array.from(t),!t.length)return"";n=e.object.merge({i18n:e.object.getPath(e,"appInstance.i18n")},n),n.delimeter=n.delimeter||n.i18n&&n.i18n.t("app.sentence.delimeter",{"default":", "}),n.conjunction=n.conjunction||n.i18n&&n.i18n.t("app.sentence.conjunction",{"default":" and "}),n.punctuate=n.punctuate===!0?".":n.punctuate,t.length>2&&(t=[t.slice(0,t.length-1).join(n.delimeter),t.slice(t.length-1)]);var i=t.join(n.conjunction);return n.punctuate&&!e.string.endsWith(i,n.punctuate)&&(i+=n.punctuate),i},e.array.union=function(){var t=e.array.from(arguments);return t=e.array.compact(t,!0),t=e.array.flatten(t),t=e.array.unique(t)},e.array.unique=function(t){return e.array.from(t).filter(function(e,n){return t.indexOf(e)===n})},e.browser.agent=function(){if(e.browser.__agent)return e.browser.__agent;var t=navigator.userAgent.toLowerCase(),n=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[],i={browser:n[1]||"",version:n[2]||"0"};return i.browser&&(i[i.browser]=!0),i.chrome?i.webkit=!0:i.webkit&&(i.safari=!0),e.browser.__agent=i},e.browser.getCookie=function(t,e){for(var n,i=e&&e.raw?function(t){return t}:decodeURIComponent,r=document.cookie.split("; "),o=0;o<r.length;o++)if(n=r[o],n&&(n=n.split("="),i(n[0])===t))return i(n[1]||"");return null},e.browser.isRetina=function(){return t.devicePixelRatio>1},e.browser.isTouchDevice=function(){return e.object.has(t,"ontouchstart")||e.object.instanceOf(document,"DocumentTouch")||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0},e.browser.testMediaQuery=function(n){n=e.browser.mediaQueries[n]||n;var i=t.matchMedia||t.msMatchMedia;return i?i(n).matches:void 0},e.browser.orientation=function(){switch(t.orientation){case 90:case-90:return"landscape";default:return"portrait"}},e.browser.setCookie=function(t,n,i){if(i=e.object.merge({},i),null==n&&(i.expires=-1),e.object.isNumber(i.expires)){var r=i.expires;i.expires=new Date,i.expires.setDate(i.expires.getDate()+r)}n=String(n);var o=[encodeURIComponent(t),"=",i.raw?n:encodeURIComponent(n),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("");return document.cookie=o,o},e.date.dateFromISO=function(t){if(!t)return null;var e=t.split(/T|\s/)[0].split("-");return new Date(e[0],e[1]-1,e[2])},e.date.now=function(t){var e=(new Date).getTime();return t&&(e=parseInt(e/1e3,10)),e},e.date.timeFromISO=function(){var t=[1,4,5,6,7,10,11];return function(n){if(!n)return 0/0;if(!/T|\s/.test(n))return e.date.dateFromISO(n);var i,r,o=0;if(r=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(n)){for(var a,s=0;a=t[s];++s)r[a]=+r[a]||0;r[2]=(+r[2]||1)-1,r[3]=+r[3]||1,"Z"!==r[8]&&void 0!==r[9]&&(o=60*r[10]+r[11],"+"===r[9]&&(o=0-o)),i=Date.UTC(r[1],r[2],r[3],r[4],r[5]+o,r[6],r[7])}else i=0/0;return new Date(i)}}(),e.dom._all=function(t,n){var i,r,o,a,s=e.array.from(t[0]),u=t[1].split("."),c=Array.prototype.slice.call(t,2),h=u[u.length-1],l=/=$/.test(h);return l&&(h=h.substr(0,h.length-1)),n&&(i=[]),s.forEach(function(t){for(o=0;o<u.length-1;o++)r=t[u[o]],t=e.fn.valueFrom(r);l?a=t[h]=c[0]:(r=t[h],a=e.fn.valueFrom(r,t,c)),n&&i.push(a)}),n?i:void 0},e.dom.all=function(){return e.dom._all(arguments,!1)},e.dom.closest=function(t,n){for(;(t=t.parentNode)&&!e.dom.isDocument(t);)if(e.dom.matches(t,n))return t},e.dom.createElement=function(t){var e=document.createElement("div");return e.innerHTML=t,e.removeChild(e.firstElementChild)},e.dom.cache=function(){return e.elementCache=e.elementCache||new e.cache,e.elementCache},e.dom.getAll=function(){return e.dom._all(arguments,!0)},e.dom.isDocument=function(t){return t&&t.nodeType===t.DOCUMENT_NODE},e.dom.isWindow=function(e){return e===t},e.dom.matches=function(t,n){var i=e.dom.prefixed(t,"matches");if(i)return i(n);if(i=e.dom.prefixed(t,"matchesSelector"))return i(n);var r=t.parentNode||t.document;return r&&r.querySelector?(e.setUid(t),t.setAttribute("data-pie-id",t.pieId),n+='[data-pie-id="'+t.pieId+'"]',r.querySelector(n)===t):!1},e.dom.off=function(t,n,i,r,o){var a,s,u,c,h=n.split(".");e.setUid(t),n=h.shift(),a=h.join("."),s="*"===n,u=e.dom.cache().getOrSet("element-"+t.pieId+".dom-events",{}),(s?Object.keys(u):[n]).forEach(function(n){c=!1,e.array.from(u[n]).forEach(function(e,s,u){null!=o||"focus"!==n&&"blur"!==n||!e.sel||(o=!0),null!=a&&a!==e.ns||null!=i&&i!==e.fn||null!=r&&r!==e.sel||o!==e.cap||(t.removeEventListener(n,e.cb,e.cap),delete u[s],c=!0)}),c&&(u[n]=e.array.compact(u[n]))})},e.dom.on=function(t,n,i,r,o){var a,s,u,c=n.split(".");return n=c.shift(),s=c.join("."),e.setUid(t),o||"focus"!==n&&"blur"!==n||!r||(o=!0),u=e.dom.cache().getOrSet("element-"+t.pieId+".dom-events",{}),u[n]=u[n]||[],a=function(n){var o,a;s&&(n.namespace=s),r?(o=e.dom.matches(n.target,r)?n.target:null,o||(a=e.dom.closest(n.target,r),a&&t.contains(a)&&(o=a)),o&&(n.delegateTarget=o,i.call(o,n))):i.call(t,n)},u[n].push({ns:s,sel:r,cb:a,fn:i,cap:o}),t.addEventListener(n,a,o),a},e.dom.parseForm=function(){var t,n=e.array.from(arguments),i=n.shift(),r=e.array.flatten(n),o=i.querySelectorAll("input[name], select[name], textarea[name]"),a={};return o=e.array.groupBy(o,"name"),e.object.forEach(o,function(n,i){r.length&&r.indexOf(n)<0||(t=i.length,"radio"===i[0].type?(t=1,i=i.filter(function(t){return t.checked})):i=i.filter(function(t){return"checkbox"===t.type?t.checked:!0}),a[n]=t>1?e.array.map(i,"value"):i[0]&&i[0].value)}),a},e.dom.prependChild=function(t,e){t.insertBefore(e,t.firstChild)},e.dom.remove=function(t){e.setUid(t),e.dom.cache().del("element-"+t.pieId),t.parentNode&&t.parentNode.removeChild(t)},e.dom.scrollParents=function(){var t=/scroll|auto/,n=function(t,e){var n=getComputedStyle(t),i=n.getPropertyValue("overflow");return e&&"x"!==e||(i+=n.getPropertyValue("overflow-x")),e&&"y"!==e||(i+=n.getPropertyValue("overflow-y")),i};return function(i,r){var o,a=r&&r.closest?void 0:[];for(r&&r.includeSelf||(i=i.parentNode);i&&!e.dom.isDocument(i);){if(o=n(i,r&&r.direction),t.test(o)){if(r&&r.closest)return i;a.unshift(i)}i=i.parentNode}return a}}(),e.dom.scrollTo=function(t,n){var i=0,r=n&&n.container||e.dom.rootScrollElement(),o=n&&n.cb,a=n&&n.gravity||"top",s=!1;if(e.object.isNumber(t)?i=t:e.object.isString(t)&&(t=r.querySelector(t)),t){var u=e.dom.position(t,r),c=e.dom.position(r);i="center"===a?u.top+u.height/2-c.height/2:"bottom"===a?u.bottom-c.height:u.top}return n&&(n.onlyUp&&r.scrollTop<=i&&(s=!0),n.onlyDown&&r.scrollTop>=i&&(s=!0)),i===r.scrollTop&&(s=!0),s?void(o&&o()):(n=e.object.merge({from:r.scrollTop,to:i,name:"easeInOutCubic",duration:250,animation:!0},n),delete n.cb,delete n.container,delete n.onlyUp,delete n.onlyDown,delete n.gravity,void e.fn.ease(function(t){r.scrollTop=t},n,o))},e.dom.rootScrollElement=function(){var t=document.body,e=document.documentElement;if(t.scrollTop)return t;if(e.scrollTop)return e;var n;return t.scrollTop=e.scrollTop=1,n=t.scrollTop?t:e,t.scrollTop=e.scrollTop=1,n},e.dom.trigger=function(t,e,n){if(!n&&"click"===e)return t.click();var i=document.createEvent("Event");return i.initEvent(e,!0,!0),t.dispatchEvent(i)},e.dom.prefixed=function(){var t=["","webkit","moz","ms","o"],n=function(t,n){return e.object.isFunction(t)?t.bind(n):t};return function(i,r){for(var o,a=0,s=e.string.capitalize(r);a<t.length;a++){if(o=t[a],i[o+r])return n(i[o+r],i);if(i["-"+o+"-"+r])return n(i["-"+o+"-"+r],i);if(i[o+s])return n(i[o+s],i)}}}(),e.dom.viewportPosition=function(){var e=Math.max(document.documentElement.clientWidth,t.innerWidth||0),n=Math.max(document.documentElement.clientHeight,t.innerHeight||0);return{top:t.scrollY,bottom:t.scrollY+n,height:n,left:t.scrollX,right:t.scrollX+e,width:e}},e.dom.position=function(t,n){if(e.dom.isWindow(t))return e.dom.viewportPosition(t);var i=0,r=0,o=t.offsetWidth,a=t.offsetHeight;for(n=n||document.body;t&&t!==n;)i+=t.offsetTop-t.scrollTop,r+=t.offsetLeft-t.scrollLeft,t=t.offsetParent;return{width:o,height:a,top:i,left:r,right:r+o,bottom:i+a}},e.dom.inViewport=function(t,n,i){var r=i||e.dom.viewportPosition(),o=n||0,a=e.dom.position(t);return a.bottom>=r.top-o&&a.top<=r.bottom+o&&a.right>=r.left-o&&a.left<=r.right+o},e.fn.async=function(t,e,n){if(!t.length)return void e();var i=t.length,r=0,o=function(){n&&n.apply(null,arguments),++r===i&&e&&e()};t.forEach(function(t){t(o)})},e.fn.debounce=function(t,n,i){var r,o,a,s,u,c=function(){var h=e.date.now()-s;n>h&&h>0?r=setTimeout(c,n-h):(r=null,i||(u=t.apply(a,o),r||(a=o=null)))};return function(){a=this,o=arguments,s=e.date.now();var h=i&&!r;return r||(r=setTimeout(c,n)),h&&(u=t.apply(a,o),a=o=null),u}},e.fn.delay=function(t,n){if(!n)return t;var i=e.date.now()+n,r=!1;return function(){var n=e.date.now();i>n?r||(r=!0,setTimeout(t,i-n)):t()}},e.fn.ease=function(t,n,i){if(n=e.object.merge({name:"linear",duration:250,from:0,to:1,delay:0,animation:!1},n),"none"===n.name)return void t(n.to,1);var r=n.animation?e.fn._easeAnimation:e.fn._easeInterval,o=function(){r(t,n,i)};n.delay&&(o=e.fn.delay(o,n.delay)),o()},e.fn._easeInterval=function(t,n,i){n.steps=n.steps||Math.max(n.duration/16,12);var r,o,a,s=e.math.easing[n.name],u=0,c=n.to-n.from,h=1/n.steps,l=function(){return r=s(u),o=n.from+r*c,t(o,u),u>=1?(u=1,clearInterval(a),i&&i()):u+=h,l};return a=setInterval(l(),n.duration/n.steps)},e.fn._easeAnimation=function(n,i,r){var o=e.dom.prefixed(t,"requestAnimationFrame");if(!o)return e.fn._easeInterval(n,i,r);var a,s,u,c,h=e.math.easing[i.name],l=0,d=i.to-i.from,f=function(t){a||(a=t,s=a+i.duration),l=(t-a)/(s-a),u=h(l),c=i.from+u*d,n(c,l),t>=s?r&&r():o(f)};o(f)},e.fn.once=function(t){var e,n=!1;return function(){return n||(n=!0,e=t.apply(null,arguments)),e}},e.fn.throttle=function(t,n,i){n=n||250;var r,o;return function(){var a=i||this,s=e.date.now(),u=arguments;r&&r+n>s?(clearTimeout(o),o=setTimeout(function(){r=s,t.apply(a,u)},n)):(r=s,t.apply(a,u))}},e.fn.valueFrom=function(t,n,i){return e.object.isFunction(t)?t.apply(n,i):t},e.math.precision=function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},e.math.easing={linear:function(t){return t},none:function(){return 1},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)},easeInOutQuad:function(t){return.5>t?2*t*t:-1+(4-2*t)*t},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return--t*t*t+1},easeInOutCubic:function(t){return.5>t?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return 1- --t*t*t*t},easeInOutQuart:function(t){return.5>t?8*t*t*t*t:1-8*--t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeOutQuint:function(t){return 1+--t*t*t*t*t},easeInOutQuint:function(t){return.5>t?16*t*t*t*t*t:1+16*--t*t*t*t*t}},e.object.compact=function(t,n){var i=e.object.merge({},t);return Object.keys(i).forEach(function(t){(null==i[t]||n&&0===i[t].toString().length)&&delete i[t]}),i},e.object.deepMerge=function(){function t(t){r[t]=e.object.has(r,t)&&e.object.isPlainObject(r[t])?e.object.deepMerge({},r[t],n[t]):e.object.isPlainObject(n[t])?e.object.deepMerge({},n[t]):n[t]}for(var n,i=e.array.from(arguments),r=i.shift();i.length;)n=i.shift(),n&&Object.keys(n).forEach(t);return r},e.object.except=function(){var t=e.array.from(arguments),n=t.shift(),i={};return t=e.array.flatten(t),Object.keys(n).forEach(function(e){t.indexOf(e)<0&&(i[e]=n[e])}),i},e.object.deletePath=function(t,n,i){~n.indexOf(".")||delete t[n];for(var r,o,a=e.string.pathSteps(n);a.length;){if(r=e.array.last(a.shift().split(".")),o=e.object.getPath(t,a[0]),!o)return;if(delete o[r],!i||!e.object.isEmpty(o))return}},e.object.dup=function(t,n){return e.object[n?"deepMerge":"merge"]({},t)},e.object.expand=function(t){var n={};return e.object.forEach(t,function(t,i){e.object.setPath(n,t,i)}),n},e.object.flatten=function(t,n,i){var r=i||{};return n=n||"",e.object.forEach(t,function(t,i){e.object.isPlainObject(i)&&!e.object.isEmpty(i)?e.object.flatten(i,n+t+".",r):r[n+t]=i}),r},e.object.isWindow=function(t){return t&&"object"==typeof t&&"setInterval"in t},e.object.isEmpty=function(t){if(!t)return!0;var e;for(e in t)return!1;return!0},e.object.isPlainObject=function(t){if(!t||!e.object.isObject(t)||t.nodeType||e.object.isWindow(t)||t.__notPlain)return!1;if(t.constructor&&!e.object.has(t,"constructor")&&!e.object.has(t.constructor.prototype,"isPrototypeOf"))return!1;var n;for(n in t);return void 0===n||e.object.has(t,n)},e.object.isNotPlainObject=function(t){return!e.object.isPlainObject(t)},["Object","Arguments","Function","String","Number","Date","RegExp","Boolean"].forEach(function(t){e.object["is"+t]=function(e){return Object.prototype.toString.call(e)==="[object "+t+"]"},e.object["isNot"+t]=function(n){return!e.object["is"+t](n)}}),function(){e.object.isArguments(arguments)||(e.object.isArguments=function(t){return t&&t.hasOwnProperty("callee")})}(),e.object.isUndefined=function(t){return void 0===t},e.object.isNotUndefined=function(t){return!e.object.isUndefined(t)},e.object.merge=function(){function t(t){r[t]=n[t]}for(var n,i=e.array.from(arguments),r=i.shift()||{};i.length;)n=i.shift(),n&&Object.keys(n).forEach(t);return r},e.object.forEach=function(t,e){t&&Object.keys(t).forEach(function(n){e(n,t[n])})},e.object.getPath=function(t,e){if(!e)return t;if(!~e.indexOf("."))return t[e];for(var n,i=e.split(".");i.length;){if(!t)return t;if(n=i.shift(),!i.length)return t[n];t=t[n]}return t},e.object.getValue=function(t,n){return e.object.isFunction(n)?n.call(null,t):null==t?void 0:e.object.isFunction(t[n])?t[n].call(t):e.object.has(t,n,!0)?t[n]:void 0},e.object.has=function(t,e,n){return t&&(t.hasOwnProperty(e)||n&&e in t)},e.object.hasAny=function(){var t,n=arguments[0];if(!n)return!1;if(1===arguments.length)return!e.object.isEmpty(n);t=e.array.flatten(e.array.get(arguments,1,-1));for(var i=0;i<t.length;i++)if(e.object.has(n,t[i]))return!0;return!1},e.object.hasPath=function(t,n){if(!~n.indexOf("."))return e.object.has(t,n);for(var i,r=n.split(".");i=r.shift();){if(!e.object.has(t,i))return!1;t=t[i]}return!0},e.object.instanceOf=function(n,i){var r=e.object.getPath(t,i);return r&&n instanceof r},e.object.reverseMerge=function(){var t=e.array.from(arguments);return t.reverse(),e.object.merge.apply(null,t)},e.object.serialize=function(t,n){var i,r,o,a=[],s=/\[\]$/;return i=function(t,i){i=e.fn.valueFrom(i),(!n||s.test(t)||null!=i&&i.toString().length)&&a.push(encodeURIComponent(t)+"="+encodeURIComponent(String(i)))},r=function(t){a.push(encodeURIComponent(t)+"=")},o=function(t,n,i){Array.isArray(n)?n.forEach(function(e){o(t+"[]",e,i)}):e.object.isPlainObject(n)?Object.keys(n).sort().forEach(function(e){o(t+"["+e+"]",n[e],i)}):i(t,n)},Object.keys(t).sort().forEach(function(e){o(e,t[e],i)}),a.join("&")},e.object.setPath=function(t,e,n){if(!~e.indexOf("."))return t[e]=n;for(var i,r=e.split(".");r.length;){if(i=r.shift(),!r.length)return t[i]=n;t=t[i]?t[i]:t[i]={}}},e.object.slice=function(){var t=e.array.from(arguments),n=t.shift(),i={};return t=e.array.flatten(t),t.forEach(function(t){e.object.has(n,t)&&(i[t]=n[t])}),i},e.object.values=function(t){return Object.keys(t).map(function(e){return t[e]})},e.string.PROTOCOL_TEST=/\w+:\/\//,e.string.capitalize=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},e.string.change=function(){var t=e.array.from(arguments),n=t.shift();return t.forEach(function(t){n=e.string[t](n)}),n},e.string.deserialize=function(){function t(t){if("undefined"===t)return void 0;if("null"===t)return null;if("true"===t)return!0;if("false"===t)return!1;if(/^-?\d*(\.\d+)?$/.test(t)){var e=parseFloat(t,10),n=parseInt(e,10);if(!isNaN(e)&&e%1)return e;if(!isNaN(n))return n}return t}function e(t,e,n){var i,r,o,a=t.split("["),s=/^\[(.+)?\]$/;for(t=a.shift(),a=a.map(function(t){return"["+t}),o=n;r=a.shift();)i=r.match(s),i[1]?(o[t]=o[t]||{},o=o[t],t=i[1]):(o[t]=o[t]||[],o=o[t],t=o.length);return o[t]=e,n}return function(n,i){var r,o,a,s,u,c={};return n?(r=n.indexOf("?"),~r&&(n=n.slice(r+1)),o=n.split("&"),o.forEach(function(n){a=n.split("="),s=decodeURIComponent(a[0]||""),u=decodeURIComponent(a[1]||""),i&&(u=t(u)),e(s,u,c)}),c):c}}(),e.string.downcase=function(t){return t.toLowerCase()},e.string.escapeRegex=function(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},e.string.escapeHtml=function(){var t={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"},n=new RegExp("["+e.string.escapeRegex(Object.keys(t).join(""))+"]","g"),i=function(e){return t[e]||""};return function(t){return null==t?t:(""+t).replace(n,i)}}(),e.string.endsWith=function(t,e){return-1!==t.indexOf(e,t.length-e.length)},e.string.expand=function(t,n,i){return n=n||{},t.replace(/\%\{(.+?)\}/g,function(r,o){if(i&&!e.object.has(n,o))throw new Error("Missing interpolation argument `"+o+"` for '"+t+"'");return n[o]})},e.string.humanize=function(t){return t.replace(/_id$/,"").replace(/([a-z][A-Z]|[a-z]_[a-z])/g,function(t,e){return e[0]+" "+e[e.length-1]})},e.string.lowerize=function(t){return t.charAt(0).toLowerCase()+t.slice(1)},e.string.modularize=function(t){return t.replace(/([^_])_([^_])/g,function(t,e,n){return e+n.toUpperCase()})},e.string.normalizeUrl=function(t){if(e.string.PROTOCOL_TEST.test(t)||"/"===t.charAt(0)||(t="/"+t),t.indexOf("?")>0){var n=t.split("?");t=e.string.normalizeUrl(n.shift()),n.unshift(t),t=n.join("?")}return t=t.replace(/(^|[^:])\/\//g,"$1/"),"#"===t.charAt(t.length-1)&&(t=t.substr(0,t.length-1)),"?"===t.charAt(t.length-1)&&(t=t.substr(0,t.length-1)),t.length>1&&"/"===t.charAt(t.length-1)&&(t=t.substr(0,t.length-1)),t},e.string.pluralize=function(t,e){return 1===e?t:/ss$/i.test(t)?t+"es":/s$/i.test(t)?t:/[a-z]$/i.test(t)?t+"s":t},e.string.possessive=function(t){return/s$/i.test(t)?t+"'":t+"'s"},e.string.setTemplateSettings=function(t,n,i,r,o,a){a=a||"~~pie-interp~~",i=i||"-",r=r||"=",o=o||"";var s=e.string.escapeRegex(t),u=e.string.escapeRegex(n),c=e.string.escapeRegex(n[0]),h=e.string.escapeRegex(r),l=e.string.escapeRegex(i),d=e.string.escapeRegex(o),f=e.string.escapeRegex(a);e.string._templateSettings={begin:t,end:n,interp:r,escape:i,eval:o,splitter:a,interpRegex:new RegExp(s+"(["+e.array.compact([h,l,d],!0).join("")+"]?)(.+?)"+u,"g"),interpLookahead:new RegExp("'(?=[^"+c+"]*"+u+")","g"),splitterRegex:new RegExp(f,"g")}},e.string.setTemplateSettings("[%","%]","-","=",""),e.string.template=function(t,n){var i=e.string._templateSettings,r="var __p='', __s = function(v, e){ return v == null ? '' : (e ? pie.string.escapeHtml(v) : v); };\n";return n&&(r+=n+";\n"),r+="__p += '",r+=t.replace(/\n/g,"\\n\\\n").replace(i.interpLookahead,i.splitter).replace(/'/g,"\\'").replace(i.splitterRegex,"'").replace(i.interpRegex,function(t,e,n){return e=e||"",e===i.escape?"' + __s("+n+", true) + '":e===i.interp?"' + __s("+n+", false) + '":e===i.eval?"'; "+n+"; __p+='":void 0}),r+="';",r+="return __p;",new Function("data",r)},e.string.titleize=function(t){return t.replace(/(^| )([a-z])/g,function(t,e,n){return e+n.toUpperCase()})},e.string.pathSteps=function(t){for(var e=t.split("."),n=[];e.length;)n.push(e.join(".")),e.pop();return n},e.string.underscore=function(t){return t.replace(/([a-z])([A-Z])/g,function(t,e,n){return e+"_"+n.toLowerCase()}).toLowerCase()},e.string.upcase=function(t){return t.toUpperCase()},e.string.urlConcat=function(){var t=e.array.compact(e.array.from(arguments),!0),n=t.shift(),i=t.join("&");return i.length?(n.indexOf("?")<0&&(n+="?"),0===i.indexOf("?")?i=i.replace("?","&"):0!==i.indexOf("&")&&(i="&"+i),n+=i,n=n.replace("?&","?").replace("&&","&").replace("??","?"),n.indexOf("?")===n.length-1&&(n=n.substr(0,n.length-1)),n):n},e.mixins.activeView={setup:function(){if(this.options.autoRender&&this.model){var t=e.object.isString(this.options.autoRender)?this.options.autoRender:"_version";this.onChange(this.model,this.render.bind(this),t)}this.options.renderOnSetup&&this.emitter.once("setup",this.render.bind(this)),this.emitter.on("render",this._renderTemplateToEl.bind(this)),this._super()},setupChild:function(t,n){var i=function(){this._renderChild(t,n)}.bind(this),r=t.events;return void 0===r&&(r=["afterRender"]),e.array.from(r).forEach(function(t){this.emitter.on(t,i)}.bind(this)),i},_renderChild:function(t,n){var i,r=t.factory,o=t.viewTransitionClass||e.simpleViewTransition,a=t.childName,s=this.getChild(a),u=s,c=t.target||t.targetEl,h=e.object.isString(t.filter)?this[t.filter].bind(this):t.filter;return e.object.isString(c)&&(c=this.qs(c)),!c||h&&h()===!1?void(s&&(this.removeChild(s),s.teardown())):(u=r(),s===u&&(s=null),i=new o(this,e.object.merge(t.viewTransitionOptions,{targetEl:c,childName:a,oldChild:s,newChild:u})),i.transition(),void(n&&n(i)))},_renderTemplateToEl:function(){var t=this.templateName();t?this.app.templates.renderAsync(t,this.renderData(),function(t){this.el.innerHTML=t,this.emitter.fire("afterRender")}.bind(this)):this.emitter.fire("afterRender")},renderData:function(){return this.model?this.model.data:{}},render:function(){this.emitter.fire("beforeRender"),this.emitter.fireAround("aroundRender",function(){this.emitter.fire("render")}.bind(this))},templateName:function(){return this.options.template}},e.mixins.bindings={init:function(){this._bindings=[],this._super&&this._super.apply(this,arguments)},setup:function(){this.emitter.on("setup",this.setupBindings.bind(this)),this.emitter.on("afterRender",this.initBindings.bind(this)),this._super.apply(this)},bind:function(){for(var t,n=0;n<arguments.length;n++)t=arguments[n],this._bindings.push(new e.binding(this,t.model||this.model,t))},setupBindings:function(){e.array.each(this._bindings,"setup",!0)},initBindings:function(){e.array.each(this._bindings,"toView",!0)},readBoundFields:function(){var t,n={skipObservers:!0};this._bindings.forEach(function(t){t.readFields(n)}),t=e.array.unique(e.array.map(this._bindings,"model")),e.array.each(t,"deliverChangeRecords",!0)}},e.mixins.changeSet={get:function(t){return this.query({name:t})},has:function(t){return e.array.areAny(this,function(e){return e.name===t})},hasAny:function(){for(var t=0;t<arguments.length;t++)if(this.has(arguments[t]))return!0;return!1},hasAll:function(){for(var t=0;t<arguments.length;t++)if(!this.has(arguments[t]))return!1;return!0},query:function(t){return this._query("detectLast",t)},queryAll:function(t){return this._query("filter",t)},_query:function(t,n){var i=e.array.from(n.names||n.name),r=e.array.from(n.types||n.type);return e.array[t](this,function(t){return!(i.length&&!~i.indexOf(t.name)||r.length&&!~r.indexOf(t.type))})}},e.mixins.container={init:function(){this.children=[],this.childNames={},this._super&&this._super.apply(this,arguments)},addChild:function(t,n){var i;return this.children.push(n),i=this.children.length-1,this.childNames[t]=i,n._indexWithinParent=i,n._nameWithinParent=t,n.parent=this,e.object.has(n,"addedToParent",!0)&&n.addedToParent.call(n),this},addChildren:function(t){e.object.forEach(t,function(t,e){this.addChild(t,e)}.bind(this))},getChild:function(t,e){if(null!=t){if(t._nameWithinParent)return t;var n=this.childNames[t];if(null==n&&(n=t),void 0===e&&(e=!0),e&&String(n).match(/\./)){for(var i,r=n.split("."),o=this;i=r.shift();){if(o=o.getChild(i),!o)return void 0;if(r.length&&!o.getChild)return void 0}return o}return~n&&this.children[n]||void 0}},bubble:function(){for(var t=e.array.from(arguments),n=t.shift(),i=this.parent;i&&!(n in i);)i=i.parent;return i?i[n].apply(i,t):void 0},sendToChildren:function(){var t=e.array.change(arguments,"from"),n=t[0],i=t.slice(1);this.children.forEach(function(r){e.object.has(r,n,!0)&&r[n].apply(r,i),e.object.has(r,"sendToChildren",!0)&&r.sendToChildren.apply(r,t)}.bind(this))},removeChild:function(t){var n,i=this.getChild(t);if(i){for(n=i._indexWithinParent,this.children.splice(n,1);n<this.children.length;n++)this.children[n]._indexWithinParent=n,this.childNames[this.children[n]._nameWithinParent]=n;delete this.childNames[i._nameWithinParent],delete i._indexWithinParent,delete i._nameWithinParent,delete i.parent,e.object.has(i,"removedFromParent",!0)&&i.removedFromParent.call(i,this)}return this},removeChildren:function(){for(var t;t=this.children[this.children.length-1];)this.removeChild(t);return this},sortChildren:function(t){this.children.sort(t),this.children.forEach(function(t,e){t._indexWithinParent=e,this.childNames[t._nameWithinParent]=e}.bind(this))},__tree:function(t){t=t||0;var e=function(t,e){if(!e)return t;for(;e-->0;)t=" "+t;return t},n="\n",i=t+(t?4:1);return n+=e((t?"|- ":"")+(this._nameWithinParent||this._indexWithinParent||this.className)+" ("+(this.className||this.pieId)+")",t),this.children.forEach(function(t){n+="\n"+e("|",i),n+=t.__tree(i)}),t||(n+="\n"),n}},e.mixins.formView={init:function(){this._super.apply(this,arguments),this._ensureModel(),this._normalizeFormOptions()},setup:function(){this._setupFormBindings(),this.on("submit",this.options.formSel,this.validateAndSubmitForm.bind(this)),this._super.apply(this,arguments)},_ensureModel:function(){this.model=this.model||this.options.model||new e.model({}),this.model.validates||this.model.reopen(e.mixins.validatable)},_normalizeFormOptions:function(){this.options.formSel=this.options.formSel||"form",this.options.fields=this.options.fields||[],this.options.fields=this.options.fields.map(function(t){if(!t||!t.name)throw new Error("A `name` property must be provided for all fields.");return t.binding=t.binding||{},t.binding.attr=t.binding.attr||t.name,t})},_onInvalid:function(){this.emitter.fire("onInvalid"),this.onInvalid.apply(this,arguments)},_onFailure:function(){this.emitter.fire("onFailure"),this.onFailure.apply(this,arguments)},_onSuccess:function(){this.emitter.fire("onSuccess"),this.onSuccess.apply(this,arguments)},_onValid:function(){this.emitter.fire("onValid"),this.onValid.apply(this,arguments)},_setupFormBindings:function(){var t;this.options.fields.forEach(function(e){this.bind(e.binding),t=e.validation,t&&(t={},t[e.name]=e.validation,this.model.validates(t,this.options.validationStrategy))}.bind(this))},ajaxOptions:function(){return this.options.ajax},applyFieldsToModel:function(){this.readBoundFields()},onInvalid:function(){},onValid:function(t){this.prepareSubmissionData(function(e){this.performSubmit(t,e,function(t,e){t?this._onSuccess(e):this._onFailure(e)}.bind(this))}.bind(this))},performSubmit:function(t,n,i){var r=app.ajax.ajax(e.object.merge({url:t.getAttribute("action"),verb:t.getAttribute("method")||"post",data:n},this.ajaxOptions()));r.dataSuccess(function(t){i(!0,t)}),r.extraError(function(t){i(!1,t.data)})},onFailure:function(){},onSuccess:function(){},prepareSubmissionData:function(t){var n=e.array.map(this.options.fields,"name"),i=this.model.gets(n);return t&&t(i),i},validateModel:function(t){this.model.validateAll(t)},validateAndSubmitForm:function(t){this.consumeEvent(t);var e=t&&t.delegateTarget;this.applyFieldsToModel(e),this.emitter.fire("submit"),this.validateModel(function(t){t?this._onValid(e):this._onInvalid(e)}.bind(this))}},e.mixins.listView=function(){var t,n=function(){return t=t||e.view.extend("defaultListItemView",e.mixins.activeView,{init:function(t,n){this.model=new e.model(n),this._super(e.object.merge({renderOnSetup:!0},t))},renderData:function(){return e.object.deepMerge({},this.bubble("renderData"),this._super())
}})},i=function(t,e){var i=n();return new i(t,e)};return{init:function(){if(this._super.apply(this,arguments),this.options=e.object.deepMerge({listOptions:{containerSel:"ul, ol, .js-items-container",loadingClass:"is-loading",modelAttribute:"items",minLoadingTime:null},itemOptions:{viewFactory:i},emptyOptions:{viewFactory:i}},this.options),!this.options.itemOptions.viewFactory)throw new Error("No viewFactory provided");this.list=this.list||new e.list([])},setup:function(){this.onChange(this.list,this.renderItems.bind(this),this.options.listOptions.modelAttribute),this.emitter.on("afterRender",this.renderItems.bind(this)),this._super.apply(this,arguments)},addItems:function(){this.listData().length?this._addListItems():this._addEmptyItem()},_addListItems:function(){var t,n=this.listContainer(),i=e.object.dup(this.options.itemOptions),r=i.viewFactory,o=[],a=function(){this.setListLoadingStyle(!1),this.emitter.fire("afterRenderItems")}.bind(this);delete i.viewFactory,this.listData().forEach(function(e,a){t=r(i,e,a),o.push(function(e){t.emitter.once("afterRender",e,{immediate:!0})}),this.addChild("list-item-"+a,t),t.addToDom(n),t.setup()}.bind(this)),e.fn.async(o,e.fn.delay(a,this.options.listOptions.minLoadingTime))},_addEmptyItem:function(){var t=e.object.dup(this.options.emptyOptions),n=t.viewFactory,i=function(){this.setListLoadingStyle(!1),this.emitter.fire("afterRenderItems")}.bind(this);if(delete t.viewFactory,!n)return void this.emitter.fire("afterRenderItems");var r=n(t,{});this.addChild("list-item-empty",r),r.emitter.once("afterRender",i,{immediate:!0}),r.addToDom(this.listContainer()),r.setup()},removeItems:function(){var t,n=/^list\-item\-/;e.array.grep(Object.keys(this.childNames),n).forEach(function(e){t=this.getChild(e),this.removeChild(t),t.teardown()}.bind(this))},renderItems:function(){this.emitter.fire("beforeRenderItems"),this.emitter.fireAround("aroundRenderItems",function(){this.emitter.fire("renderItems"),this.setListLoadingStyle(!0),this.removeItems(),this.addItems()}.bind(this))},setListLoadingStyle:function(t){var e=this.options.listOptions.loadingClass;e&&this.listContainer().classList[t?"add":"remove"](e)},listData:function(){return this.list.get(this.options.listOptions.modelAttribute)||[]},listContainer:function(){var t=this.options.listOptions.containerSel;return t&&this.qs(t)||this.el}}}(),e.mixins.validatable={init:function(){this.validations=[],this.validationStrategy="dirty",this._super&&this._super.apply(this,arguments),this.compute("isValid","validationErrors")},isValid:function(){return e.object.isEmpty(this.data.validationErrors)},reportValidationError:function(t,e){e=e&&e.length?e:void 0,this.set("validationErrors."+t,e)},validates:function(t,n){var i,r;this.validations=this.validations||{},Object.keys(t).forEach(function(n){i=e.array.from(t[n]),r=[],i.forEach(function(t){e.object.isString(t)?r.push({type:t,options:{}}):e.object.isFunction(t)?r.push({type:"fn",options:{fn:t}}):Object.keys(t).forEach(function(n){r.push(e.object.isObject(t[n])?{type:n,options:t[n]}:{type:n,options:e.object.merge({},t)})})}),this.validations[n]=this.validations[n]||[],this.validations[n]=this.validations[n].concat(r),this.observe(function(t){var e=t.get(n);return this.validationChangeObserver(e)}.bind(this),n)}.bind(this)),void 0!==n&&(this.validationStrategy=n)},validateAll:function(t){var n,i=!0,r=Object.keys(this.validations),o=function(){return void(t&&t(i))},a=function(t){i=!(!i||!t)};return r.length?(n=r.map(function(t){return function(e){return this.validate(t,e)}.bind(this)}.bind(this)),void e.fn.async(n,o,a)):o()},validationChangeObserver:function(t){"validate"===this.validationStrategy?this.validate(t.name):"dirty"===this.validationStrategy&&this.get("validationErrors."+t.name+".length")&&this.reportValidationError(t.name,void 0)},validate:function(t,n){var i,r,o=this.app.validator,a=e.array.from(this.validations[t]),s=this.get(t),u=!0,c=function(t,e){u=!(!u||!e),e||(r=r||[],r.push(o.errorMessage(t.type,t.options)))},h=function(){return this.reportValidationError(t,r),void(n&&n(u))}.bind(this);return a.length?(i=a.map(function(t){return function(e){var n=o[t.type],i=function(n){e(t,n)},r=n.call(o,s,t.options,i);(r===!0||r===!1)&&e(t,r)}}),void e.fn.async(i,h,c)):h()}},e.base=function(){e.setUid(this),this.init.apply(this,arguments),this.app||(this.app=this.options&&this.options.app?this.options.app:e.appInstance),this.debugName&&(t.pieDebug=t.pieDebug||{},t.pieDebug[e.fn.valueFrom(this.debugName)]=this)},e.base.prototype.pieRole="object",e.base.prototype.init=function(){},e.base.prototype.reopen=function(){var t=e.array.change(arguments,"from","flatten"),n=function(t,n){this[t]=e.base._wrap(n,this[t])}.bind(this);return t.forEach(function(t){e.object.forEach(t,n),t.init&&t.init.call(this)}.bind(this)),this},e.base.subClasses=[],e.base.extend=function(){return e.base._extend(e.base,arguments)},e.base.reopen=function(){return e.base._reopen(e.base,arguments)},e.base._extend=function(t,n){n=e.array.change(n,"from","flatten");var i=n.length;if(n=e.array.compact(n),n.length!==i)throw new Error("Null values not allowed");var r,o="";return e.object.isString(n[0])&&(o=n.shift()),e.object.isFunction(n[0])&&n.unshift({init:n.shift()}),o||(o=e.object.getPath(n[0],"init.name")||""),r=new Function("var f = function "+o+"(){\n  var myProto = Object.getPrototypeOf(this);\n  var parentProto = Object.getPrototypeOf(myProto);\n  parentProto.constructor.apply(this, arguments);\n};\n"+(o?"var "+o+" = null;\n":"")+"return f;")(),r.className=o,r.prototype=Object.create(t.prototype),r.prototype.className=o,r.extend=function(){return e.base._extend(r,arguments)},r.reopen=function(){return e.base._reopen(r,arguments)},n.length&&r.reopen(n),r},e.base._reopen=function(t,n){n=e.array.change(n,"from","flatten","compact"),n.forEach(function(n){e.object.forEach(n,function(n,i){t.prototype[n]=e.base._wrap(i,t.prototype[n])})})},e.base._wrap=function(){var t=/xyz/.test(function(){"xyz"});return t=t?/\b_super\b/:/.*/,function(n,i){return null==n?i:null==i?n:e.object.isFunction(n)&&e.object.isFunction(i)&&t.test(n)?function(){var t,e=this._super;return this._super=i,t=n.apply(this,arguments),e?this._super=e:delete this._super,t}:n}}(),e.app=e.base.extend("app",{init:function(n){if(delete this.app,e.appInstance=e.appInstance||this,e.apps[this.pieId]=this,this.options=e.object.deepMerge({uiTarget:"body",unsupportedPath:"/browser/unsupported",notificationStorageKey:"js-alerts",verifySupport:!0},n),this.options.verifySupport&&!this.verifySupport())return void(t.location.href=this.options.unsupportedPath);var i=function(t,n){var i=this.options[t]||n,r=this.options[t+"Options"]||{};return e.object.isFunction(i)?new i(this,r):(i.app=this,i)}.bind(this);this.config=i("config",e.config),this.cache=i("cache",e.cache),this.storage=i("storage",e.dataStore),this.emitter=i("emitter",e.emitter),this.i18n=i("i18n",e.i18n),this.ajax=i("ajax",e.ajax),this.notifier=i("notifier",e.notifier),this.errorHandler=i("errorHandler",e.errorHandler),this.parsedUrl=new e.model({}),this.router=i("router",e.router),this.routeHandler=i("routeHandler",e.routeHandler),this.resources=i("resources",e.resources),this.helpers=i("helpers",e.helpers),this.templates=i("templates",e.templates),this.navigator=i("navigator",e.navigator),this.validator=i("validator",e.validator),this.navigator.observe(this.parseUrl.bind(this)),this.parsedUrl.observe(this.parsedUrlChanged.bind(this)),this.emitter.once("beforeStart",this.setupSinglePageLinks.bind(this)),this.emitter.once("afterStart",this.showStoredNotifications.bind(this)),this.options.noAutoStart||document.addEventListener("DOMContentLoaded",this.start.bind(this)),this._super()},retrieve:function(t,e){return this.storage.get(t,{clear:void 0===e||e})},store:function(t,e){return this.storage.set(t,e)},confirm:function(e){t.confirm(e.text)?e.onConfirm&&e.onConfirm():e.onDeny&&e.onDeny()},debug:function(){t.console&&t.console.log&&t.console.log.apply(t.console,arguments)},go:function(){var t,n,i,r=e.array.from(arguments);if(t=r.shift(),t=e.object.isPlainObject(r[0])?this.router.path(t,r.shift()):this.router.path.apply(this.router,e.array.from(t)),t!==this.parsedUrl.get("fullPath")){i=e.object.isBoolean(r[0])?r.shift():!1,n=r,n.length&&(n[0]=this.i18n.attempt(n[0]));var o=this.router.parseUrl(t);o.route&&(o.view||o.redirect)?(this.softGo(t,i),n.length&&this.notifier.notify.apply(this.notifier,n)):(n.length&&this.storage.set(this.options.notificationStorageKey,n),this.hardGo(t))}},softGo:function(t,e){this.navigator.go(t,{},e)},hardGo:function(e){t.location.href=e},goBack:function(){t.history.back()},handleSinglePageLinkClick:function(t){if(!t.delegateTarget.getAttribute("target")&&!t.ctrlKey&&!t.metaKey){var e=t.delegateTarget.getAttribute("href");e&&!/^(#|[a-z]+:\/\/)/.test(e)&&("?"===e.charAt(0)&&(e=this.parsedUrl.get("fullPath")+e),t.preventDefault(),this.go(e))}},parseUrl:function(){var t=this.router.parseUrl(this.navigator.get("fullPath"));this.parsedUrl.setData(t)},parsedUrlChanged:function(t){t.has("fullPath")&&this.emitter.fire("urlChanged"),this.routeHandler.handle(t)},setupSinglePageLinks:function(){var t=e.qs(this.options.navigationContainer||this.options.uiTarget);e.dom.on(t,"click",this.handleSinglePageLinkClick.bind(this),"a[href]")},showStoredNotifications:function(){var t=this.storage.get(this.options.notificationStorageKey);t&&t.length&&this.notifier.notify.apply(this.notifier,t)},start:function(){this.emitter.fireSequence("start",this.navigator.start.bind(this.navigator))},verifySupport:function(){var e=document.createElement("_");return!!(e.classList&&t.history.pushState&&Date.prototype.toISOString&&Array.isArray&&Array.prototype.forEach&&Object.keys&&Number.prototype.toFixed)}},e.mixins.container),e.model=e.base.extend("model",{pieRole:"model",init:function(t,n){t&&"model"===t.pieRole&&(t=t.data),this.data=e.object.deepMerge({_version:1},t),this.options=n||{},this.app=this.app||this.options.app||e.appInstance,this.observations={},this.changeRecords=[],this.deliveringRecords=0,this._super()},compute:function(){var t,n=e.array.from(arguments),i=n.shift(),r=n.shift();n=e.array.flatten(n),e.object.isFunction(r)||(n.unshift(r),r=this[i].bind(this)),t=function(){this.set(i,r.call(this),{skipObservers:!0})}.bind(this),this.observe(t,n),this.observations[t.pieId].computed=!0,this.set(i,r.call(this))},hasOne:function(t,n,i){i=i||e.model,n=n||t+"Model",this.compute(n,function(){var e=this.get(t);if(e){var r=this.get(n)||new i;return r.sets(e),r}return void 0},t)},hasMany:function(t,n,i){i=i||e.list,n=n||t+"List",this.compute(n,function(){var e=this.get(t);if(e){var r=this.get(n)||new i;return Array.isArray(e)&&(e={items:e}),r.sets(e),r}return void 0},t)},addChangeRecord:function(t,n,i,r){var o=e.array.detect(this.changeRecords,function(e){return e.name===t});if(o)return o.value=r,void("delete"===o.type&&"add"===n?o.type="update":"delete"===o.type&&"pathUpdate"===n?o.type="pathUpdate":"delete"===n&&(o.type=n));var a={name:t,type:n,value:r};null!=i&&(a.oldValue=i),this.changeRecords.push(a)},deliverChangeRecords:function(t){if(!this.changeRecords.length)return this;if(this.deliveringRecords)return this;t&&t.skipVersionTracking||this.trackVersion();var n,i,r=this.changeRecords,o=e.object.values(this.observations),a=function(t){r.hasAny.apply(r,t.keys)&&t.fn.call(null,r)};for(e.object.merge(r,e.mixins.changeSet);~(i=e.array.indexOf(o,"computed"));)n=o[i],o.splice(i,1),a(n);return this.changeRecords=[],this.deliveringRecords++,o.forEach(a),this.deliveringRecords--,this.deliverChangeRecords(t),this},get:function(t){return e.object.getPath(this.data,t)},getOrSet:function(t,e){var n=this.get(t);return null!=n?n:(this.set(t,e),this.get(t))},gets:function(){var t=e.array.change(arguments,"from","flatten","compact"),n={};return t.forEach(function(t){this.has(t)&&e.object.setPath(n,t,this.get(t))}.bind(this)),n},has:function(t){return!!e.object.hasPath(this.data,t)},hasAll:function(){var t,n=e.array.change(arguments,"from","flatten");for(t=0;t<n.length;t++)if(!this.has(n[t]))return!1;return!0},hasAny:function(){var t,n=e.array.change(arguments,"from","flatten");for(t=0;t<n.length;t++)if(this.has(n[t]))return!0;return!n.length},is:function(t){return!!this.get(t)},merge:function(){var t=arguments.length>1?e.object.deepMerge.apply(null,arguments):arguments[0];t=e.object.flatten(t),this.sets(t)},observe:function(){var t=e.array.change(arguments,"from","flatten"),n=e.array.partition(t,e.object.isFunction),i=n[0],r=n[1];return r.length||(r=["_version"]),i.forEach(function(t){e.setUid(t),this.observations[t.pieId]={fn:t,keys:r}}.bind(this)),this},reset:function(t){var e=Object.keys(this.data),n={};return e.forEach(function(t){"_version"!==t&&(n[t]=void 0)}),this.sets(n,t)},set:function(t,n,i){if(e.object.isPlainObject(n)&&!e.object.isEmpty(n))return this.set(t,void 0,e.object.merge({},i,{skipObservers:!0,skipParents:!0})),n=e.object.flatten(n,t+"."),void this.sets(n,i);var r,o,a,s=t;if(o=e.object.getPath(this.data,t),!(i&&i.force||n!==o))return this;void 0!==o&&(r="update");var u,c,h,l=i&&i.skipParents||!~t.indexOf(".")?null:e.string.pathSteps(t).slice(1);if(i&&i.skipChildren||!e.object.isPlainObject(o)||(u=Object.keys(e.object.flatten(o,t+"."))),c=u||l?e.object.merge({},i,{skipChildren:!0,skipParents:!0}):null,u&&u.length)for(h=0;h<u.length;h++)this.set(u[h],void 0,c);if(a=n,void 0===n?(r="delete",e.object.deletePath(this.data,t)):(e.object.setPath(this.data,t,n),r=r||"add"),l&&l.length){var d;for(h=0;h<l.length;h++)d=this.get(l[h]),"delete"===r&&e.object.isObject(d)&&e.object.isEmpty(d)?this.set(l[h],void 0,c):this.addChangeRecord(l[h],"pathUpdate",void 0,void 0)}return this.addChangeRecord(s,r,o,a),i&&i.skipObservers?this:this.deliverChangeRecords(i)},setData:function(t,n){var i=Object.keys(e.object.flatten(this.data)),r=Object.keys(e.object.flatten(t)),o=e.array.subtract(i,r),a=e.object.merge({},n,{skipObservers:!0});return o=e.array.remove(o,"_version"),o.forEach(function(t){this.set(t,void 0,a)}.bind(this)),this.sets(t,n)},sets:function(t,n){var i=e.object.merge({},n,{skipObservers:!0});return e.object.forEach(t,function(t,e){this.set(t,e,i)}.bind(this)),n&&n.skipObservers?this:this.deliverChangeRecords(n)},test:function(t,n){var i=this.get(t);return i===n?!0:null==i?!1:e.object.isRegExp(n)?n.test(String(i)):!1},touch:function(){this.trackVersion(),this.deliverChangeRecords({skipVersionTracking:!0})},trackVersion:function(){this.set("_version",this.get("_version")+1,{skipObservers:!0})},unobserve:function(){var t,n=e.array.change(arguments,"from","flatten"),i=e.array.partition(n,e.object.isFunction),r=i[0],o=i[1];return r.forEach(function(n){return e.setUid(n),(t=this.observations[n.pieId])?o.length?(t.keys=e.array.subtract(t.keys,o),t.keys.length?void 0:void delete this.observations[n.pieId]):void delete this.observations[n.pieId]:void 0}.bind(this)),this}}),e.config=e.model.extend("config",{init:function(t,e){e=e||{},e.app=t,this._super({},e),this.dynamicKeys={}},_onDynamicChange:function(t){var n,i,r=this.get(t);n=this.get(t+"Config.defaults"),i=r&&this.get(t+"Config."+r),this.sets(e.object.deepMerge({},n,i))},dynamic:function(t,n){var i=this.get(t+"Config")||{};this.set(t+"Config",e.object.deepMerge(i,n)),this.dynamicKeys[t]||(this.dynamicKeys[t]=!0,this.observe(function(){this._onDynamicChange(t)}.bind(this),t)),this._onDynamicChange(t)}}),e.dataStore=e.base.extend("dataStore",{init:function(t,n){this.app=t,this.options=e.object.merge({primary:"sessionStorage",backup:"backup"},n),this._super(),this.backupModel=new e.model({})},primary:function(){return this._store(this.options.primary)},backup:function(){return this._store(this.options.backup)},_store:function(t){return e.object.isString(t)?e.dataStore.adapters[t]:t},clear:function(t){this.primary().clear(t,this),this.primary().clear(t,this)},get:function(t,n){var i=this.primary().get(t,this);return i===e.dataStore.ACCESS_ERROR&&(i=this.backup().get(t,this)),(!n||void 0===n.clear||n.clear)&&this.clear(t),i},set:function(t,n){this.clear(t);var i=this.primary().set(t,n,this);return i===e.dataStore.ACCESS_ERROR&&(i=this.backup().set(t,n,this)),i}}),e.dataStore.ACCESS_ERROR=new Error("~~PIE_ACCESS_ERROR~~"),e.dataStore.adapters=function(){var n=function(n,i){try{if(!t[n])return e.dataStore.ACCESS_ERROR;var r=t[n].getItem(i);return null!=r?JSON.parse(r):r}catch(o){return this.app.errorHandler.reportError(o,{handledBy:"pie.dataStore."+n+"#get",key:i}),e.dataStore.ACCESS_ERROR}},i=function(n,i,r){var o;try{return t[n]?(o=JSON.stringify(r),t[n].setItem(i,o),!0):e.dataStore.ACCESS_ERROR}catch(a){return this.app.errorHandler.reportError(a,{handledBy:"pie.dataStore."+n+"#get",key:i,data:o}),e.dataStore.ACCESS_ERROR}},r=function(n,i){try{if(!t[n])return e.dataStore.ACCESS_ERROR;t[n].removeItem(i)}catch(r){return this.app.errorHandler.reportError(r,{handledBy:"pie.dataStore."+n+"#clear",key:i}),e.dataStore.ACCESS_ERROR}};return{sessionStorage:{clear:function(t,e){return r.call(e,"sessionStorage",t)},get:function(t,e){return n.call(e,"sessionStorage",t)},set:function(t,e,n){return i.call(n,"sessionStorage",t,e)}},localStorage:{clear:function(t,e){return r.call(e,"localStorage",t)},get:function(t,e){return n.call(e,"localStorage",t)},set:function(t,e,n){return i.call(n,"localStorage",t,e)}},cookie:{clear:function(t){try{return e.browser.setCookie(t,null)}catch(n){return e.dataStore.ACCESS_ERROR}},get:function(t){try{var n=e.browser.getCookie(t);return null!=n?JSON.parse(n):n}catch(i){return e.dataStore.ACCESS_ERROR}},set:function(t,n){try{var i=JSON.stringify(n);e.browser.setCookie(t,i)}catch(r){return e.dataStore.ACCESS_ERROR}}},backup:{clear:function(t,e){e.backupModel.set(t,void 0)},get:function(t,e){e.backupModel.get(t)},set:function(t,e,n){n.backupModel.set(t,e)}}}}(),e.view=e.base.extend("view"),e.view.prototype.constructor=function(){e.base.prototype.constructor.apply(this,arguments),this.options.setup&&this.setup()},e.view.reopen({pieRole:"view",init:function(t){this.options=t||{},this.app=this.options.app||e.appInstance,this.el=this.options.el||document.createElement("div"),this.eventedEls=[],this.changeCallbacks=[],this.emitter=new e.emitter,this.options.uiTarget&&this.emitter.once("afterSetup",this.addToDom.bind(this)),this._super()},addedToParent:function(){this.emitter.fire("addedToParent")},appendToDom:function(t){this.addToDom(t,"appendChild")},addToDom:function(t,e){t=t||this.options.uiTarget,t!==this.el.parentNode&&this.emitter.fireSequence("attach",function(){e?t.insertBefore(this.el,t.firstChild):t.appendChild(this.el)}.bind(this))},consumeEvent:function(t,e){t&&(t.preventDefault(),t.stopPropagation(),e&&t.stopImmediatePropagation())},eventNamespace:function(){return"view"+this.pieId},navigationUpdated:function(t){this.emitter.fire("navigationUpdated",t),this.children.forEach(function(n){e.object.has(n,"navigationUpdated",!0)&&n.navigationUpdated(t)})},on:function(){var t,n,i=e.array.from(arguments),r=i.shift(),o=i.shift(),a=this.eventNamespace();return e.object.isFunction(e.array.get(i,-1))||(n=i.pop()),n=n||this.el,~this.eventedEls.indexOf(n)||this.eventedEls.push(n),r=r.split(" "),i.forEach(function(i){i=e.object.isString(i)?this[i].bind(this):i,t=function(t){return t.namespace===a?i.apply(this,arguments):void 0},r.forEach(function(i){i+="."+a,e.dom.on(n,i,t,o)}.bind(this))}.bind(this)),this},onChange:function(){var t=e.array.partitionAt(arguments,e.object.isFunction),n=t[0],i=t[1];n.forEach(function(t){if(!e.object.has(t,"observe",!0))throw new Error("Observable does not respond to observe");this.changeCallbacks.push({observable:t,args:i}),t.observe.apply(t,i)}.bind(this))},qs:function(t){return this.el.querySelector(t)},qsa:function(t){return this.el.querySelectorAll(t)},removeFromDom:function(){this.el.parentNode&&this.emitter.fireSequence("detach",function(){this.el.parentNode.removeChild(this.el)}.bind(this))},removedFromParent:function(){this.emitter.fire("removedFromParent")},setup:function(){return this.emitter.fireSequence("setup"),this},teardown:function(){return this.emitter.fireSequence("teardown",function(){this.removeFromDom(),this._unobserveEvents(),this._unobserveChangeCallbacks(),this.teardownChildren(),this.removeChildren()}.bind(this)),this},teardownChildren:function(){this.children.forEach(function(t){e.object.has(t,"teardown",!0)&&t.teardown()})},_unobserveEvents:function(){var t="*."+this.eventNamespace();this.eventedEls.forEach(function(n){e.dom.off(n,t)})},_unobserveChangeCallbacks:function(){for(var t;this.changeCallbacks.length;)t=this.changeCallbacks.pop(),t.observable.unobserve.apply(t.observable,t.args)}},e.mixins.container),e.activeView=e.view.extend("activeView",e.mixins.activeView),e.ajaxRequest=e.model.extend("ajaxRequest",{init:function(t,n){this._super(t,n),this.getOrSet("headers",{}),this.xhr=null,this.emitter=new e.emitter,this.validates({url:{presence:!0},verb:{inclusion:{"in":e.object.values(this.VERBS)}}},null)},VERBS:{del:"DELETE",get:"GET",patch:"PATCH",post:"POST",put:"PUT"},_append:function(t,n,i){n=e.array.change(n,"from","flatten"),n.forEach(function(e){this.emitter.on(t,e,{immediate:i})}.bind(this))},_onDataSuccess:function(t){this.emitter.fire("dataSuccess",t)},_onSetModel:function(t){this.emitter.fire("setModel",t)},_onSuccess:function(t,e){this.emitter.fire("success",t,e)},_onComplete:function(t){this.emitter.fire("complete",t)},_onError:function(t){this.emitter.fire("error",t),this.emitter.fire("extraError",t)},_onProgress:function(t){this.emitter.fire("progress",t)},_onUploadProgress:function(t){this.emitter.fire("uploadProgress",t)},_parseOptions:function(t){t&&(t=e.object.merge({},t),["setup","complete","dataSuccess","error","extraError","progress","success","uploadProgress","setModel"].forEach(function(n){t[n]&&(e.array.from(t[n]).forEach(function(t){this[n](t)}.bind(this)),delete t[n])}.bind(this)),this.sets(t))},_validateOptions:function(t){this.get("verb")&&this.set("verb",this.get("verb").toUpperCase()),this.validateAll(function(e){if(!e)throw new Error(JSON.stringify(this.get("validationErrors")));t()}.bind(this))},_applyHeaders:function(t){var n=this.get("accept"),i=this.get("contentType"),r=this.get("headers"),o=this.get("data");this._applyCsrfToken(t),n&&(r.Accept=n),i!==!1&&(i&&(r["Content-Type"]=i),r["Content-Type"]||(r["Content-Type"]=e.object.isString(o)||e.object.instanceOf(o,"FormData")?"application/x-www-form-urlencoded":"application/json")),e.object.forEach(r,function(e,n){t.setRequestHeader(e,n)})},_applyCsrfToken:function(t){var n=e.fn.valueFrom(this.get("csrfToken"));n=n||this.app.cache.getOrSet("csrfToken",function(){var t=e.qs('meta[name="csrf-token"]');return t?t.getAttribute("content"):null}),n&&t.setRequestHeader("X-CSRF-Token",n)},_parseResponse:function(t){var e=this.get("accept"),n=e&&this.responseParsers[e]||this.responseParsers.default;t.data=this.response=n.call(this,t)},responseParsers:{"application/json":function(t){try{return t.responseText.trim().length?JSON.parse(t.responseText):{}}catch(n){return this.app.debug.apply(this.app,e._debugArgs("could not parse JSON response: "+n)),{}}},"default":function(t){return t.responseText}},_buildXhr:function(){var t=new XMLHttpRequest,n=this.get("url"),i=this.get("verb"),r=this.get("data"),o=this.get("tracker"),a=this;return i===this.VERBS.get&&r&&(n=e.string.urlConcat(n,e.object.serialize(r))),n=e.string.normalizeUrl(n),this.hasCallback("progress")&&t.addEventListener("progress",this._onProgress.bind(this),!1),this.hasCallback("uploadProgress")&&t.upload.addEventListener("progress",this._onUploadProgress.bind(this),!1),t.open(i,n,!0),this._applyHeaders(t),this.emitter.fire("setup",t,this),t.onload=function(){o&&o(t,a),a._parseResponse(t),t.status>=200&&t.status<300||304===t.status?(a._onDataSuccess(a.response),a._onSetModel(a.response),a._onSuccess(a.response,t)):a._onError(t),a._onComplete(t)},this.xhr=t,this.emitter.fire("xhrBuilt"),t},build:function(t,e){return this._parseOptions(t),this._validateOptions(function(){this._buildXhr(),e||this.send()}.bind(this)),this},send:function(){var t,n=this.get("data");return this.get("verb")!==this.VERBS.get&&(t=e.object.isString(n)||e.object.instanceOf(n,"FormData")?n:JSON.stringify(e.object.compact(n))),this.xhr.send(t),this},hasCallback:function(t){return this.emitter.hasCallback(t)},setup:function(){return this._append("setup",arguments,!1),this},clear:function(t){return this.emitter.clear(t),this},complete:function(){return this._append("complete",arguments,!0),this},dataSuccess:function(){return this._append("dataSuccess",arguments,!0),this},error:function(){return this._append("error",arguments,!0),this},extraError:function(){return this._append("extraError",arguments,!0),this},setModel:function(){var t=e.array.from(arguments).map(function(t){return t.sets.bind(t)});this._append("setModel",t,!0)},success:function(){return this._append("success",arguments,!0),this},progress:function(){return this._append("progress",arguments,!1),this},uploadProgress:function(){return this._append("uploadProgress",arguments,!1),this}},e.mixins.validatable),e.ajax=e.base.extend("ajax",{init:function(t){this.app=t,this._super()},defaultAjaxOptions:{verb:"GET",accept:"application/json",headers:{}},_normalizeOptions:function(t){return e.object.isString(t)&&(t={url:t}),t},ajax:function(t,n){t=e.object.deepMerge({},this.defaultAjaxOptions,this._normalizeOptions(t));var i=new e.ajaxRequest({},{app:this.app});return i.build(t,n),i.emitter.hasCallback("error")||i.error(this.app.errorHandler.handleXhrError.bind(this.app.errorHandler)),i},del:function(t,n){return t=e.object.merge({verb:"DELETE"},this._normalizeOptions(t)),this.ajax(t,n)},get:function(t,n){return t=e.object.merge({verb:"GET"},this._normalizeOptions(t)),this.ajax(t,n)},patch:function(t,n){return t=e.object.merge({verb:"PATCH"},this._normalizeOptions(t)),this.ajax(t,n)},post:function(t,n){return t=e.object.merge({verb:"POST"},this._normalizeOptions(t)),this.ajax(t,n)},put:function(t,n){return t=e.object.merge({verb:"PUT"},this._normalizeOptions(t)),this.ajax(t,n)}}),e.cache=e.model.extend("cache",{init:function(t,e){this._super(t,e)},clear:function(){this.reset()},del:function(t){this.set(t,void 0)},expire:function(t,e){var n=this.get(t);return void 0===n?!1:(this.set(t,n,{ttl:e}),!0)},get:function(t){var e=this._super(t);return e&&e.__data?e.__expiresAt&&e.__expiresAt<=this.currentTime()?void this.set(t,void 0):e.__data:e},set:function(t,n,i){if(null==n||"_version"===t||i&&i.noWrap)this._super(t,n,i);else{var r=this.wrap(n,i);this._super(t,r,e.object.merge({noWrap:!0},i))}},wrap:function(t,n){n=n||{};var i=n.expiresAt||n.expiresIn||n.ttl;return i&&(e.object.instanceOf(i,"Date")&&(i=i.getTime()),e.object.isString(i)&&(i=/^\d+$/.test(i)?parseInt(i,10):e.date.timeFromISO(i).getTime()),String(i).length<13&&(i=this.currentTime()+i)),{__data:e.fn.valueFrom(t),__expiresAt:i,__notPlain:!0}},currentTime:function(){return e.date.now()}}),e.emitter=e.model.extend("emitter",{init:function(){this._super({triggeredEvents:{},eventCallbacks:{}})},clear:function(t){this.set("eventCallbacks."+t,void 0)},hasEvent:function(t){return!!this.firedCount(t)},hasCallback:function(t){var e=this.get("eventCallbacks."+t);return!(!e||!e.length)},firedCount:function(t){return this.get("triggeredEvents."+t+".count")||0},lastInvocation:function(t){return this.get("triggeredEvents."+t+".lastArgs")||[]},waitUntil:function(){var t=/^around/;return function(){var n,i=e.array.from(arguments),r=i.pop();n=i.map(function(e){if(t.test(e))throw new Error(e+" is not supported by waitUntil.");return function(t){this.once(e,t,{immediate:!0})}.bind(this)}.bind(this)),e.fn.async(n,r)}}(),_on:function(t,n,i,r){i=i||{};var o=this.lastInvocation(t);(i.now||i.immediate&&this.hasEvent(t))&&(n.apply(null,o),i.onceOnly)||this.getOrSet("eventCallbacks."+t,[])[r](e.object.merge({fn:n},i))},_once:function(t,n,i,r){i=e.object.merge({onceOnly:!0},i),this._on(t,n,i,r)},on:function(t,e,n){this._on(t,e,n,"push")},prepend:function(t,e,n){this._on(t,e,n,"unshift")},once:function(t,e,n){this._once(t,e,n,"push")},prependOnce:function(t,e,n){this._once(t,e,n,"unshift")},_reportTrigger:function(t,e){var n=this.get("triggeredEvents");n[t]||(n[t]={count:0}),n[t].lastArgs=e,n[t].count=n[t].count+1},fire:function(){var t=e.array.from(arguments),n=t.shift(),i=this.get("eventCallbacks."+n),r=!1;this._reportTrigger(n,t),i&&i.forEach(function(e,n){e.fn.apply(null,t),e.onceOnly&&(r=!0,i[n]=void 0)}),r&&this.set("eventCallbacks."+n,e.array.compact(i))},fireSequence:function(t,n){var i=e.string.modularize("before_"+t),r=e.string.modularize("after_"+t),o=e.string.modularize("around_"+t);this.fire(i),this.fireAround(o,function(){n&&n(),this.fire(t),this.fire(r)}.bind(this))},fireAround:function(t,n){var i,r=this.get("eventCallbacks."+t),o=!1;this._reportTrigger(t),r?(i=r.map(function(t,e){return t.onceOnly&&(o=!0,r[e]=void 0),t.fn}),o&&this.set("eventCallbacks."+t,e.array.compact(r)),e.fn.async(i,n)):n()}}),e.errorHandler=e.model.extend("errorHandler",{init:function(t){this._super({responseCodeHandlers:{}},{app:t})},xhrData:function(t){return t.data=t.data||(t.status?JSON.parse(t.response):{})},errorMessagesFromRequest:function(t){var n,i=this.xhrData(t),r=e.array.from(i.error||i.message||i.errors||[]);return r=r.map(function(t){return e.object.isString(t)?t:t.message}),r=e.array.compact(r,!0),n=this.app.i18n.t("app.errors."+t.status,{"default":r}),this.app.debug.apply(this.app,e._debugArgs(r)),e.array.from(n)},getResponseCodeHandler:function(t){return this.get("responseCodeHandlers."+t)},handleXhrError:function(t){var e=this.getResponseCodeHandler(t.status.toString());e?e.call(t,t):this.notifyErrors(t)},handleI18nError:function(t,e){this.reportError(t,e)},notifyErrors:function(t){var e=this.app.notifier,n=this.errorMessagesFromRequest(t);n.length&&(e.clear("error"),setTimeout(function(){e.notify(n,"error",1e4)},100))},registerHandler:function(t,e){this.set("responseCodeHandlers."+t.toString(),e)},reportError:function(t,e){e=e||{},this._reportError(t,e)},_reportError:function(t,n){this.app.debug.apply(this.app,e._debugArgs(String(t)+" | "+JSON.stringify(n)))}}),e.formView=e.view.extend("formView",e.mixins.activeView,e.mixins.bindings,e.mixins.formView),e.helpers=e.model.extend("helpers",{init:function(t,n){this._super({fns:{}},e.object.merge({app:t,variableName:"h"},n));var i=this.app.i18n;this.register("t",i.t.bind(i)),this.register("l",i.l.bind(i)),this.register("timeago",i.timeago.bind(i)),this.register("path",this.app.router.path.bind(this.app.router)),this.register("get",e.object.getPath),this.register("render",this.renderPartials.bind(this))},register:function(t,e){return this.set("fns."+t,e)},fetch:function(t){return this.get("fns."+t)},call:function(){var t=e.array.from(arguments),n=t.shift();return this.fetch(n).apply(null,t)},renderPartials:function(t,n){return e.array.map(n,function(e){return this.app.templates.render(t,e)}.bind(this)).join("\n")},functions:function(){return this.get("fns")},provideVariables:function(){return"var app = pie.apps["+this.app.pieId+"]; var "+this.options.variableName+" = app.helpers.functions();"}}),e.i18n=e.model.extend("i18n",{init:function(t,n){var i=e.object.merge({},e.i18n.defaultTranslations);n=e.object.deepMerge({settings:{interpolationStart:"%{",interpolationEnd:"}",nestedStart:"${",nestedEnd:"}"}},n||{},{app:t});var r=e.string.escapeRegex(n.settings.interpolationEnd),o=e.string.escapeRegex(n.settings.nestedEnd);n.settings.interpolationRegex=new RegExp(e.string.escapeRegex(n.settings.interpolationStart)+"([^"+o+"]+)"+r,"g"),n.settings.nestedRegex=new RegExp(e.string.escapeRegex(n.settings.nestedStart)+"([^"+o+"]+)"+o,"g"),this._super(i,n)},_ampm:function(t){return this.t("app.time.meridiems."+(t>=12?"pm":"am"))},_countAlias:{0:"zero",1:"one","-1":"negone"},_dayName:function(t){return this.t("app.date.day_names."+t,{"default":""})||this.t("app.time.day_names."+t)
},_hour:function(t){return t>12&&(t-=12),t||(t+=12),t},_monthName:function(t){return this.t("app.date.month_names."+t,{"default":""})||this.t("app.time.month_names."+t)},_nestedTranslate:function(t,e){return this._expand(t,this.options.settings.nestedRegex,function(t,n){return this.translate(n,e)}.bind(this))},_interpolateTranslation:function(t,n){return this._expand(t,this.options.settings.interpolationRegex,function(t,i){return e.object.getPath(n,i)})},_expand:function(t,e,n){try{var i;return t.replace(e,function(e,r){if(i=n(e,r),void 0===i)throw new Error("Missing interpolation argument `"+r+"` for '"+t+"'");return i})}catch(r){return this.app.errorHandler.handleI18nError(r,{handledBy:"pie.i18n#_expand",expandString:t,regex:e}),""}},_normalizedDate:function(t){return String(t).match(/^\d+$/)?(t=parseInt(t,10),String(t).length<13&&(t*=1e3),t=new Date(t)):t=e.object.isString(t)?e.date.timeFromISO(t):new Date(t),t},_shortDayName:function(t){return this.t("app.date.short_day_names."+t,{"default":""})||this.t("app.time.short_day_names."+t,{"default":""})||this._dayName(t).slice(0,3)},_shortMonthName:function(t){return this.t("app.date.short_month_names."+t,{"default":""})||this.t("app.time.short_month_names."+t,{"default":""})||this._monthName(t).slice(0,3)},_pad:function(t,e,n,i){var r="",o=e-t.toString().length;for(void 0===n&&(n=" ");o>0;)r+=i?n+r:r+n,o-=1;return r+t.toString()},_ordinal:function(t){var e=t%100;return e=e>=11&&13>=e?0:t%10,this.t("app.time.ordinals.o"+e)},_timezoneAbbr:function(t){var e=t&&t.toString();return e&&e.split(/\((.*)\)/)[1]},_utc:function(t){var e=new Date(t.getTime());return e.setMinutes(e.getMinutes()+e.getTimezoneOffset()),e},keyCheck:/^\.(.+)$/,attempt:function(){var t=e.array.from(arguments),n=t[0],i=n&&n.match(this.keyCheck);return i?(t[0]=i[1],this.translate.apply(this,t)):n},load:function(t,n){var i=n?e.object.merge:e.object.deepMerge;i.call(null,this.data,t)},translate:function(){var t,n=e.array.change(arguments,"from","compact"),i=n.shift(),r=e.object.isObject(n[0])?n.shift():void 0,o=this.get(i);if(e.object.has(r,"count")&&e.object.isObject(o)&&(t=(r.count||0).toString(),t=this._countAlias[t]||(t>0?"other":"negother"),o=void 0===o[t]?o.other:o[t]),!o)if(e.object.has(r,"default")){var a=e.fn.valueFrom(r.default);o=e.object.isString(a)?this.attempt(a):a}else if(null==o)return this.app.errorHandler.handleI18nError(new Error("Translation not found: "+i),{handledBy:"pie.i18n#translate",translationPath:i}),"";return e.object.isString(o)&&(o=-1===o.indexOf(this.options.settings.nestedStart)?o:this._nestedTranslate(o,r),o=-1===o.indexOf(this.options.settings.interpolationStart)?o:this._interpolateTranslation(o,r)),n.length&&(n.unshift(o),o=e.string.change.apply(null,n)),o},timeago:function(t,e,n){var i,r,o=t,a=e;return t=this._normalizedDate(t).getTime()/1e3,e=this._normalizedDate(e||new Date).getTime()/1e3,i=e-t,n=n||"app",60>i?this.t(n+".timeago.now",{count:i}):3600>i?(r=Math.floor(i/60),this.t(n+".timeago.minutes",{count:r})):86400>i?(r=Math.floor(i/3600),this.t(n+".timeago.hours",{count:r})):604800>i?(r=Math.floor(i/86400),this.t(n+".timeago.days",{count:r})):2592e3>i?(r=Math.floor(i/604800),this.t(n+".timeago.weeks",{count:r})):31572500>i?(r=12*(a.getFullYear()-o.getFullYear()),r-=o.getMonth(),r+=a.getMonth(),this.t(n+".timeago.months",{count:r})):(r=Math.floor(i/31536e3),this.t(n+".timeago.years",{count:r}))},strftime:function(t,e){t=this._normalizedDate(t),~e.indexOf("%")||(e=this.t("app.time.formats."+e,{"default":e}));var n=t.getDay(),i=t.getDate(),r=t.getFullYear(),o=t.getMonth()+1,a=t.getHours(),s=this._hour(a),u=this._ampm(a),c=t.getSeconds(),h=t.getMinutes(),l=t.getMilliseconds(),d=t.getTimezoneOffset(),f=Math.floor(Math.abs(d/60)),p=Math.abs(d)-60*f,m=(d>0?"-":"+")+this._pad(f,2,"0")+this._pad(p,2,"0");return e=e.replace("%a",this._shortDayName(n)).replace("%A",this._dayName(n)).replace("%B",this._monthName(o-1)).replace("%b",this._shortMonthName(o-1)).replace("%d",this._pad(i,2,"0")).replace("%e",this._pad(i,2," ")).replace("%-do",i+this._ordinal(i)).replace("%-d",i).replace("%H",this._pad(a,2,"0")).replace("%k",this._pad(a,2," ")).replace("%-H",a).replace("%-k",a).replace("%I",this._pad(s,2,"0")).replace("%l",s).replace("%m",this._pad(o,2,"0")).replace("%-m",o).replace("%M",this._pad(h,2,"0")).replace("%p",u.toUpperCase()).replace("%P",u).replace("%S",this._pad(c,2,"0")).replace("%-S",c).replace("%L",this._pad(l,3,"0")).replace("%-L",l).replace("%w",n).replace("%y",this._pad(r%100)).replace("%Y",r).replace("%z",m).replace("%:z",m.slice(0,3)+":"+m.slice(3)).replace("%Z",this._timezoneAbbr(t))}}),e.i18n.prototype.t=e.i18n.prototype.translate,e.i18n.prototype.l=e.i18n.prototype.strftime,e.i18n.defaultTranslations={app:{sentence:{conjunction:" and ",delimeter:", "},timeago:{now:"just now",minutes:{one:"%{count} minute ago",other:"%{count} minutes ago"},hours:{one:"%{count} hour ago",other:"%{count} hours ago"},days:{one:"%{count} day ago",other:"%{count} days ago"},weeks:{one:"%{count} week ago",other:"%{count} weeks ago"},months:{one:"%{count} month ago",other:"%{count} months ago"},years:{one:"%{count} year ago",other:"%{count} years ago"}},time:{today:"Today",formats:{isoDate:"%Y-%m-%d",isoTime:"%Y-%m-%dT%H:%M:%S.%L%:z",shortDate:"%m/%d/%Y",longDate:"%B %-do, %Y"},meridiems:{am:"am",pm:"pm"},ordinals:{o0:"th",o1:"st",o2:"nd",o3:"rd",o4:"th",o5:"th",o6:"th",o7:"th",o8:"th",o9:"th"},day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],short_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:["January","February","March","April","May","June","July","August","September","October","November","December"],short_month_names:["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"]},validations:{ccNumber:"does not look like a credit card number",ccSecurity:"is not a valid security code",ccExpirationMonth:"is not a valid expiration month",ccExpirationYear:"is not a valid expiration year",ccExpirationDate:"is not a valid expiration date",chosen:"must be chosen",date:"is not a valid date",email:"must be a valid email",format:"is invalid",inclusion:"is not a valid value",integer:"must be an integer",length:"length must be",number:"must be a number",phone:"is not a valid phone number",presence:"can't be blank",uniqueness:"is not unique",url:"must be a valid url",range_messages:{eq:"equal to %{count}",lt:"less than %{count}",gt:"greater than %{count}",lte:"less than or equal to %{count}",gte:"greater than or equal to %{count}"}}}},e.list=e.model.extend("list",{init:function(t,e){t=t||[],this._super({},e),this.data.items=t.map(this._cast.bind(this))},_cast:function(t){var n=this.options.cast;return n===!0&&(n=e.model),n&&e.object.isPlainObject(t)&&(t=new n(t,this.options.castOptions)),t},_normalizedIndex:function(t){return t=parseInt(t,10),!isNaN(t)&&0>t&&(t+=this.data.items.length),t},_trackMutations:function(t,n){var i=this.data.items.length,r=e.array.from(n.call()),o=this.data.items.length;return t&&t.skipTrackMutations||(i!==o&&r.push({name:"length",type:"update",object:this.data.items,oldValue:i,value:o}),r.push({name:"items",type:"update",object:this.data.items,oldValue:this.data.items,value:this.data.items})),this.changeRecords=this.changeRecords.concat(r),t&&t.skipObservers?this:this.deliverChangeRecords()},forEach:function(t){return this.get("items").forEach(t)},get:function(t){var n,i=this._normalizedIndex(t);return n=isNaN(i)?t:"items."+i,e.model.prototype.get.call(this,n)},indexOf:function(t){return this.get("items").indexOf(t)},insert:function(t,e,n){return this._trackMutations(n,function(){e=this._cast(e);var n=this._normalizedIndex(t),i={name:String(n),object:this.data.items,type:"add",oldValue:this.data.items[n],value:e};return this.data.items.splice(n,0,e),i}.bind(this))},length:function(){return this.get("items.length")},pop:function(t){var e,n=this.length();if(n)return this._trackMutations(t,function(){var t={name:String(n-1),object:this.data.items,type:"delete",value:void 0};return t.oldValue=e=this.data.items.pop(),t}.bind(this)),e},push:function(t,e){return this._trackMutations(e,function(){t=this._cast(t);var e={name:String(this.data.items.length),object:this.data.items,type:"add",value:t,oldValue:void 0};return this.data.items.push(t),e}.bind(this))},remove:function(t,e){var n;return this._trackMutations(e,function(){var e=this._normalizedIndex(t),i={name:String(e),object:this.data.items,type:"delete"};return i.oldValue=n=this.data.items[e],this.data.items.splice(e,1),i.value=this.data.items[e],i}.bind(this)),n},set:function(t,e,n){if("items"===t)return this.setItems(e,n);var i=this._normalizedIndex(t);return isNaN(i)?this._super(t,e,n):this._trackMutations(n,function(){var t={name:String(i),object:this.data.items,type:"update",oldValue:this.data.items[i]};return e=this._cast(e),this.data.items[i]=t.value=e,t}.bind(this))},setItems:function(t,n){var i=e.object.merge({},n,{skipTrackMutations:!0,skipObservers:!0});return this._trackMutations(n,function(){var e,n=this.data.items.length,r=t.length;if(n>r){for(e=n;e>r;)this.pop(i),e--;for(e=r-1;e>=0;e--)this.set(e,t[e],i)}else{for(e=0;n>e;e++)this.set(e,t[e],i);for(e=n;r>e;)this.push(t[e],i),e++}}.bind(this))},shift:function(t){return this.remove(0,t)},unshift:function(t,e){return this.insert(0,t,e)}}),e.listView=e.view.extend("listView",e.mixins.activeView,e.mixins.listView),e.navigator=e.model.extend("navigator",{init:function(t){this.app=t,this._super({})},go:function(n,i,r){var o,a,s,u=n.split("?");return n=u[0],o=u[1],i=e.object.deepMerge(o?e.string.deserialize(o):{},i),this.test("path",n)&&this.test("query",i)?this:(a=n,e.object.hasAny(i)&&(a=e.string.urlConcat(a,e.object.serialize(i))),s=this.stateObject(n,i,r),t.history[r?"replaceState":"pushState"](s,document.title,a),void t.historyObserver())},setDataFromLocation:function(){var n=t.location.search.slice(1),i=e.string.deserialize(n);this.sets({url:t.location.href,path:t.location.pathname,anchor:t.location.hash.slice(1),fullPath:e.array.compact([t.location.pathname,n],!0).join("?"),query:i})},start:function(){return t.historyObserver||(t.historyObserver=function(){e.dom.trigger(document.body,"pieHistoryChange")}),e.dom.on(t,"popstate",function(){t.historyObserver()}),e.dom.on(document.body,"pieHistoryChange.nav-"+this.pieId,this.setDataFromLocation.bind(this)),this.setDataFromLocation()},stateObject:function(n,i,r){var o={navigator:{path:n,query:i}};return r?e.object.deepMerge(o,t.history.state):(o.navigator.referringPath=this.get("path"),o.navigator.referringQuery=this.get("query")),o}}),e.notifier=e.base.extend("notifier",{init:function(t,n){this.options=n||{},this.app=t||this.options.app||e.appInstance,this.notifications=new e.list([]),this._super()},clear:function(t){if(t)this.notifications.forEach(function(t){this.remove(t.id)}.bind(this));else for(;this.notifications.length();)this.remove(this.notifications.get(0).id)},notify:function(t,n,i){n=n||"message",i=this.getAutoRemoveTimeout(i),t=e.array.from(t),t=t.map(function(t){return this.app.i18n.attempt(t)}.bind(this));var r={id:e.unique(),messages:t,type:n};this.notifications.push(r),i&&setTimeout(function(){this.remove(r.id)}.bind(this),i)},getAutoRemoveTimeout:function(t){return void 0===t&&(t=!0),t&&!e.object.isNumber(t)&&(t=7e3),t},remove:function(t){var n=e.array.indexOf(this.notifications.get("items"),function(e){return e.id===t});~n&&this.notifications.remove(n)}}),e.resources=e.model.extend("resources",{init:function(t,n){this._super({srcMap:n||{},loaded:{}},{app:t}),e.object.forEach(function(t,e){this.define(t,e)}.bind(this))},_appendNode:function(t){var n=e.qs("head");n=n||document.body,n.appendChild(t)},_inferredResourceType:function(t){return/(\.|\/)js(\?|$)/.test(t)?"script":/(\.|\/)css(\?|$)/.test(t)?"link":/\.(png|jpeg|jpg|gif|svg|tiff|tif)(\?|$)/.test(t)?"image":"ajax"},_normalizeSrc:function(t){var n="string"==typeof t?{src:t}:e.object.merge({},t);return n},_loadajax:function(t,n){var i=e.object.merge({verb:"GET",url:t.src},t),r=this.app.ajax.ajax(i);r.success(n)},_loadimage:function(t,n){var i=new Image;i.onload=function(){n(e.object.merge({img:i},t))},i.src=t.src},_loadlink:function(t,e){var n=document.createElement("link");n.href=t.src,n.media=t.media||"screen",n.rel=t.rel||"stylesheet",n.type=t.contentType||"text/css",this._appendNode(n),e()},_loadscript:function(t,e){var n=document.createElement("script");t.noAsync&&(n.async=!1),t.callbackName||(n.onload=e),this._appendNode(n),n.src=t.src},define:function(t,e){var n=this._normalizeSrc(e);this.set("srcMap."+t,n)},load:function(){var n,i=e.array.change(arguments,"from","flatten","compact"),r=e.object.isFunction(e.array.last(i))?i.pop():function(){};i=i.map(this._normalizeSrc.bind(this)),n=i.map(function(e){e=this.get("srcMap."+e.src)||e;var n=e.src,i="loaded."+n;return function(n){var r=this.get(i);if(r===!0)return n(),!0;if(r)return r.push(n),!1;this.set(i,[n]);var o=e.type||this._inferredResourceType(e.src),a=function(){this.get(i).forEach(function(t){t&&t()}),this.set(i,!0),e.callbackName&&delete t[e.callbackName]}.bind(this);return e.callbackName&&(t[e.callbackName]=a),this["_load"+o](e,a),!1}.bind(this)}.bind(this)),e.fn.async(n,r)}}),e.route=e.model.extend("route",{init:function(t,n){this._super({pathTemplate:e.string.normalizeUrl(t)},n),this.name=this.options.name||"route-"+this.pieId,this.compute("segments","pathTemplate"),this.compute("pathRegex","pathTemplate"),this.compute("weight","segments")},segments:function(){return this.get("pathTemplate").split("/")},pathRegex:function(){var t=this.get("pathTemplate");return t=e.string.escapeRegex(t),t=t.replace(/(:[^\/\?]+)/g,"([^\\/\\?]+)"),t=t.replace(/(\\\*[^\/]+)/g,"(.+)"),new RegExp("^"+t+"$")},weight:function(){var t=this.get("segments"),e="";return t.forEach(function(t){e+=t.match(/^:([^\/]+)$/)?"3":t.match(/^\*([^\/]+)$/)?"2":""===t?"1":"4"}),+e},interpolations:function(t,n){for(var i,r,o=t.split("/"),a=this.get("segments"),s={},u=0;u<o.length;u++)if(r=a[u],i=o[u],i!==r)if(":"===r.charAt(0))s[r.substr(1)]=i;else if("*"===r.charAt(0)){s[r.substr(1)]=e.array.get(o,u,-1).join("/");break}return n&&(s=e.string.deserialize(e.object.serialize(s),!0)),s},isDirectMatch:function(t){return t===this.get("pathTemplate")},isMatch:function(t){return this.get("pathRegex").test(t)},path:function(t,n){var i,r,o=[],a=this.get("pathTemplate");return t=t||{},a=a.replace(/[:\*]([a-zA-Z0-9_]+)/g,function(e,n){if(o.push(n),void 0===t[n]||null===t[n]||0===t[n].toString().length)throw new Error("[PIE] missing route interpolation: "+e);return t[n]}),a=e.string.normalizeUrl(a),r=e.object.except(t,o),i=e.object.serialize(e.object.compact(r,!0)),!n&&i.length&&(a=e.string.urlConcat(a,i)),a}}),e.router=e.model.extend("router",{init:function(t,n){this._super({root:n&&n.root||"/"},e.object.merge({app:t},n)),this.cache=new e.cache,this.compute("rootRegex","root")},rootRegex:function(){return new RegExp("^"+this.get("root"))},changedUrl:function(t){var n=this.app.parsedUrl;return this.path(n.get("route.name")||n.get("path"),e.object.merge({},n.get("data"),t))},findRoute:function(t){var e=this.getChild(t,!1);return e=e||this.findDirectMatch(t),e=e||this.findPatternMatch(t)},findDirectMatch:function(t){return e.array.detect(this.children,function(e){return e.isDirectMatch(t)})},findPatternMatch:function(t){return e.array.detect(this.children,function(e){return e.isMatch(t)})},map:function(t,n){n=n||{};var i,r,o,a;e.object.forEach(t,function(t,s){e.object.isObject(s)?(i=t,r=s,n&&(r=e.object.merge({},n,r))):(i=s,r={name:t}),a=this.findDirectMatch(i)||r.name||this.findRoute(r.name),this.removeChild(a),o=new e.route(i,r),this.addChild(o.name,o)}.bind(this)),this.sortRoutes(),this.cache.clear()},onMiss:function(t){this.missedConfig=t},path:function(t,n,i){var r,o,a=this.findRoute(t)||new e.route(t.split("?")[0]);return o=~t.indexOf("?")?e.string.deserialize(t.split("?")[1]):{},o=e.object.merge(o,a.interpolations(t),n),r=a.path(o,i),e.string.PROTOCOL_TEST.test(r)||this.get("rootRegex").test(r)||(r=this.get("root")+r,r=e.string.normalizeUrl(r)),r},sortRoutes:function(){var t;this.sortChildren(function(e,n){return t=n.get("weight")-e.get("weight"),t=t||n.get("pathTemplate").length-e.get("pathTemplate").length,t=t||e.get("pathTemplate").localeCompare(n.get("pathTemplate"))})},parseUrl:function(t,n){var i=this.cache.getOrSet(t,function(){var i,r,o,a,s,u,c;return r=t.split("?"),t=r.shift(),t=t.replace(this.get("rootRegex"),""),t=e.string.normalizeUrl(t),o=r.join("&")||"",a=this.findRoute(t),o=e.string.deserialize(o,n),s=e.array.compact([t,e.object.serialize(o)],!0).join("?"),u=e.string.normalizeUrl(this.get("root")+t),c=a&&a.interpolations(t,n),i=e.object.merge({path:t,fullPath:s,pathWithRoot:u,interpolations:c||{},query:o,data:e.object.merge({},c,o),route:a},a&&a.options||this.missedConfig)}.bind(this));return e.object.deepMerge({},i)}},e.mixins.container),e.routeHandler=e.base.extend("routeHandler",{init:function(t,n){this.app=t,this.options=e.object.merge({viewNamespace:"lib.views",uiTarget:"body",viewKey:"view",viewTransitionClass:e.simpleViewTransition,viewTransitionOptions:{}},n),this.urlModel=this.app.parsedUrl,this.emitter=this.app.emitter,this._super()},refresh:function(){var t=this.app.getChild("currentView");t._pieName="__remove__",this.urlModel.touch()},currentView:function(){return this.app.getChild("currentView")},handle:function(t){return this.handleRedirect(t)||this.handleView(t)},handleRedirect:function(){var t=this.urlModel.get("redirect");return t?(this.app.go(t),!0):!1},handleView:function(t){var n=this.currentView();return n&&n._pieName===this.urlModel.get(this.options.viewKey)?(this.emitter.fire("navigationUpdated",t),e.object.has(n,"navigationUpdated",!0)&&n.navigationUpdated(t),!0):this.urlModel.get(this.options.viewKey)?(this.transitionToNewView(t),!0):!1},transitionToNewView:function(n){var i,r,o,a,s=this.currentView();i=e.object.isString(this.options.uiTarget)?e.qs(this.options.uiTarget):this.options.uiTarget,this.emitter.fire("beforeViewChanged",n),this.emitter.fireAround("aroundViewChanged",function(){this.emitter.fire("viewChanged",n),r=e.object.getPath(t,this.options.viewNamespace+"."+this.urlModel.get(this.options.viewKey)),o=new r({app:this.app}),o._pieName=this.urlModel.get(this.options.viewKey),a=new this.options.viewTransitionClass(this.app,e.object.merge({oldChild:s,newChild:o,childName:"currentView",targetEl:i},this.options.viewTransitionOptions)),a.emitter.on("afterRemoveOldChild",function(){this.emitter.fire("oldViewRemoved",s)}.bind(this)),a.emitter.on("afterTransition",function(){this.emitter.fire("newViewLoaded",o)}.bind(this)),a.transition(function(){this.emitter.fire("afterViewChanged",n)}.bind(this))}.bind(this))}}),e.templates=e.model.extend("templates",{init:function(t,n){this._super({},e.object.merge({app:t,templateSelector:'script[type="text/pie-template"]'},n))},_node:function(t){return e.qs(this.options.templateSelector+'[id="'+t+'"]')},ensureTemplate:function(t,e){var n,i,r;if(this.get(t))return void e(t);if(n=this._node(t),i=n&&(n.content||n.textContent),r=n&&n.getAttribute("data-src"),i)return this.registerTemplate(t,i),void e(t);if(!r)throw new Error("[PIE] Template fetch error: "+t);this.load(t,{url:r},function(){this.ensureTemplate(t,e)}.bind(this))},registerTemplate:function(t,n){var i=e._debugArgs("Compiling template: %c"+t);i.push("color: #aaa;"),this.app.debug.apply(this.app,i),this.set(t,e.string.template(n,this.app.helpers.provideVariables()))},load:function(t,n,i){n=e.object.merge({verb:"get",accept:"text/html"},n);var r=this.app.ajax.ajax(n);r.dataSuccess(function(e){this.registerTemplate(t,e)}.bind(this)).error(function(){throw new Error("[PIE] Template fetch error: "+t)}).complete(function(){i()})},render:function(t,e){if(!this.get(t)){var n=this._node(t);if(!n)throw new Error("[PIE] Unknown template error: "+t);this.registerTemplate(t,n.content||n.textContent)}return this.get(t)(e||{})},renderAsync:function(t,e,n){this.ensureTemplate(t,function(){var i=this.render(t,e);n(i)}.bind(this))}}),e.validator=e.base.extend("validator",{init:function(t,n){this.app=t||e.appInstance,this.i18n=t.i18n,this.options=e.object.deepMerge({formats:{isoDate:/^\d{4}\-\d{2}\-\d{2}$/,isoTime:/^\d{4}\-\d{2}\-\d{2}T\d{2}-\d{2}-\d{3}/,epochs:/^\d{10}$/,epochms:/^\d{13}$/}},n),this._super()},errorMessage:function(t,n){if(n.message){var i=n.message;return e.object.isFunction(i)&&(i=i(t,n)),this.app.i18n.attempt(i)}var r=n.messageKey||t,o=this.i18n.t("app.validations."+r),a=new e.validator.rangeOptions(this.app,n),s=a.message();return s||"length"!==r||(a=new e.validator.rangeOptions(this.app,{gt:0}),s=a.message()),(o+" "+s).trim()},withStandardChecks:function(t,e,n){return e=e||{},e.allowBlank&&!this.presence(t)?!0:e.unless&&e.unless.call()?!0:e["if"]&&!e["if"].call()?!0:n.call()},ccNumber:function(){var t=function(t){var e,n,i,r;for(i=+t[e=t.length-1],r=0;e--;)n=+t[e],i+=++r%2?2*n%10+(n>4):n;return!(i%10)};return function(e,n){return this.withStandardChecks(e,n,function(){var n=String(e).replace(/[^a-zA-Z0-9]/g,"");return this.number(n)&&this.length(n,{gte:10,lte:16})&&t(n)}.bind(this))}}(),ccExpirationMonth:function(t,e){return this.withStandardChecks(t,e,function(){return this.integer(t,{gte:1,lte:12})}.bind(this))},ccExpirationYear:function(t,e){return this.withStandardChecks(t,e,function(){var e=new Date;return this.integer(t,{gte:e.getFullYear(),lte:e.getFullYear()+20})}.bind(this))},ccSecurity:function(t,e){return this.withStandardChecks(t,e,function(){return this.number(t)&&this.length(t,{gte:3,lte:4})}.bind(this))},chosen:function(){var t=function(t){return null!=t&&""!==t};return function(e,n){return this.withStandardChecks(e,n,function(){return Array.isArray(e)?!!e.filter(t).length:t(e)})}}(),date:function(t,n){return n=n||{},this.withStandardChecks(t,n,function(){var i,r,o=t.split("-"),a=o[0],s=o[1],u=o[2];if(!a||!s||!u)return!1;if(!this.length(a,{eq:4})||!this.length(s,{eq:2})||!this.length(u,{eq:2}))return!1;if(!this.number(a)||!this.number(s,{gte:1,lte:12})||!this.number(u,{gte:1,lte:31}))return!1;if(r=new Date(a,s-1,u),r.getDate()!==parseInt(u,10))return!1;n.sanitized||(Object.keys(n).forEach(function(t){i=n[t],i=this.app.i18n.l(i,"isoDate"),n[t]=i}),n.sanitized=!0);var c=new e.validator.rangeOptions(this.app,n);return c.matches(t)}.bind(this))},email:function(t,n){return n=e.object.merge({allowBlank:!1},n||{}),this.withStandardChecks(t,n,function(){return/^.+@.+\..+$/.test(t)})},fn:function(t,e,n){return this.withStandardChecks(t,e,function(){return e.fn.call(null,t,e,n)})},format:function(t,e){return e=e||{},this.withStandardChecks(t,e,function(){var n=e.format||e["with"];return n=this.options.formats[n]||n,!!n.test(String(t))}.bind(this))},inclusion:function(t,n){return n=n||{},this.withStandardChecks(t,n,function(){var i=e.fn.valueFrom(n["in"]);return Array.isArray(i)?!i.length||!!~i.indexOf(t):null==i||i===t})},integer:function(t,e){return this.withStandardChecks(t,e,function(){return this.number(t,e)&&parseInt(t,10)===parseFloat(t,10)}.bind(this))},length:function(t,n){return n=e.object.merge({allowBlank:!1},n),e.object.hasAny(n,"gt","gte","lt","lte","eq")||(n.gt=0),this.withStandardChecks(t,n,function(){var e=Array.isArray(t)?t.length:String(t).trim().length;return this.number(e,n)}.bind(this))},number:function(t,n){return n=n||{},this.withStandardChecks(t,n,function(){if(!/^([\-])?([\d]+)?\.?[\d]+$/.test(String(t)))return!1;var i=parseFloat(t),r=new e.validator.rangeOptions(this.app,n);return r.matches(i)})},phone:function(t,n){return n=e.object.merge({allowBlank:!1},n||{}),this.withStandardChecks(t,n,function(){var e=String(t).replace(/[^\+\d]+/g,"");return this.length(e,{gte:10})}.bind(this))},presence:function(t,n){return this.withStandardChecks(t,e.object.merge({},n,{allowBlank:!1}),function(){return!(!t||!/[^ ]/.test(String(t)))})},uniqueness:function(t,n){return this.withStandardChecks(t,n,function(){if(!n.within)return!0;for(var i=e.fn.valueFrom(n.within),r=0,o=0;r<i.length;r++)if(i[r]===t&&o++,o>1)return!1;return!0})},url:function(t,n){return n=e.object.merge({},n,{format:/^https?\:\/\/.+\..+$/}),this.format(t,n)}}),e.validator.rangeOptions=e.base.extend("rangeOptions",{init:function(t,n){this.i18n=t.i18n,this.rangedata=n||{},e.object.has(this.rangedata,"rangedata")&&(this.rangedata=this.rangedata.rangedata),this._super()},get:function(t){return e.fn.valueFrom(this.rangedata[t])},has:function(t){return e.object.has(this.rangedata,t)},t:function(t,e){return this.i18n.t("app.validations.range_messages."+t,e)},matches:function(t){var e=!0;return e=e&&(!this.has("gt")||t>this.get("gt")),e=e&&(!this.has("lt")||t<this.get("lt")),e=e&&(!this.has("gte")||t>=this.get("gte")),e=e&&(!this.has("lte")||t<=this.get("lte")),e=e&&(!this.has("eq")||t===this.get("eq"))},message:function(){if(this.has("eq"))return this.t("eq",{count:this.get("eq")});var t=["",""];return this.has("gt")?t[0]+=this.t("gt",{count:this.get("gt")}):this.has("gte")&&(t[0]+=this.t("gte",{count:this.get("gte")})),this.has("lt")?t[1]+=this.t("lt",{count:this.get("lt")}):this.has("lte")&&(t[1]+=this.t("lte",{count:this.get("lte")})),e.array.toSentence(e.array.compact(t,!0),this.i18n).trim()}}),e.abstractViewTransition=e.base.extend("abstractViewTransition",{init:function(t,n){if(n=n||{},this.emitter=new e.emitter,this.parent=t,this.oldChild=n.oldChild,this.newChild=n.newChild,this.childName=n.childName||this.oldChild&&this.oldChild._nameWithinParent,this.targetEl=n.targetEl||this.oldChild&&this.oldChild.el.parentNode,!this.childName)throw new Error("No child name provided for view transition");if(!this.targetEl)throw new Error("No target element provided for view transition");this.options=n,this.emitter.on("beforeTransition",this.manageChildren.bind(this)),this.propagateTransitionEvents(),this._super()},transition:function(t){var e=this.emitter;e.on("afterAddNewChild",function(){e.fire("afterTransition"),t&&t()}),e.on("afterRemoveOldChild",function(){e.fire("beforeAddNewChild"),e.fireAround("aroundAddNewChlid",function(){e.fire("addNewChild")})}),e.on("transition",function(){e.fire("beforeRemoveOldChild"),e.fireAround("aroundRemoveOldChild",function(){e.fire("removeOldChild")})}),e.fire("beforeTransition"),e.fireAround("aroundTransition",function(){e.fire("transition")})},manageChildren:function(){this.oldChild&&this.parent.removeChild(this.oldChild),this.newChild&&(this.parent.addChild(this.childName,this.newChild),this.newChild.emitter.hasEvent("beforeSetup")||this.newChild.setup())},propagateTransitionEvents:function(){var t=this.emitter,e=this.oldChild&&this.oldChild.emitter,n=this.newChild&&this.newChild.emitter;e&&(t.on("beforeRemoveOldChild",function(){e.fire("beforeTransitionOut")}),t.on("afterRemoveOldChild",function(){e.fire("afterTransitionOut")})),n&&(t.on("beforeAddNewChild",function(){n.fire("beforeTransitionIn")}),t.on("afterTransition",function(){n.fire("afterTransitionIn")}))}}),e.simpleViewTransition=e.abstractViewTransition.extend("simpleViewTransition",{init:function(){this._super.apply(this,arguments),this.emitter.on("removeOldChild",this.removeOldChild.bind(this)),this.emitter.on("addNewChild",this.addNewChild.bind(this))},setLoading:function(t){this.options.loadingClass&&this.targetEl.classList[t?"add":"remove"](this.options.loadingClass)},addNewChild:function(){return this.newChild?(this.begin=e.date.now(),this.setLoading(!0),this.options.minDelay&&setTimeout(this.attemptToAddChild.bind(this),this.options.minDelay),void this.newChild.emitter.once("afterSetup",this.attemptToAddChild.bind(this),{immediate:!0})):void this.emitter.fire("afterAddNewChild")},attemptToAddChild:function(){var t=e.date.now();this.newChild.emitter.hasEvent("afterSetup")&&(this.options.minDelay&&t<this.begin+this.options.minDelay||this.newChild.parent===this.parent&&(this.setLoading(!1),this.newChild.addToDom(this.targetEl),this.emitter.fire("afterAddNewChild")))},removeOldChild:function(){this.oldChild&&this.oldChild.teardown(),this.emitter.fire("afterRemoveOldChild")}}),e.loadingViewTransition=e.simpleViewTransition.extend("loadingViewTransition",{init:function(){this._super.apply(this,arguments),this.options.loadingClass=this.options.loadingClass||"is-loading"}}),e.inOutViewTransition=e.abstractViewTransition.extend("inOutViewTransition",{init:function(){this._super.apply(this,arguments),this.options=e.object.merge({inClass:"view-in",outClass:"view-out",backupDuration:250,async:!1},this.options),this.setupObservations()},setupObservations:function(){var t=this.emitter;this.oldChild?(t.on("transitionOldChild",this.cancelWrap("transitionOldChild")),t.on("afterTransitionOldChild",this.cancelWrap("teardownOldChild"))):t.on("transitionOldChild",function(){t.fire("afterTransitionOldChild")}),this.newChild?(t.on("addNewChild",this.cancelWrap("addNewChild")),t.on("aroundTransitionNewChild",this.cancelWrap("ensureNewChildPrepared")),t.on("transitionNewChild",this.cancelWrap("refresh")),t.on("transitionNewChild",this.cancelWrap("transitionNewChild")),this.newChild.emitter.once("removedFromParent",this.cancel.bind(this))):t.on("transitionNewChild",function(){t.fire("afterTransitionNewChild")})},cancelWrap:function(t){return function(){this.emitter.hasEvent("cancel")||this[t].apply(this,arguments)}.bind(this)},applyClass:function(t,e){var n=e?this.options.inClass:this.options.outClass,i=e?this.options.outClass:this.options.inClass;n&&t.classList.add(n),i&&t.classList.remove(i)},transition:function(t){var e=this.emitter;e.on("afterTransitionNewChild",function(){e.fire("afterTransition"),t&&t()}),this.options.async?e.on("transition",function(){e.fireSequence("addNewChild")}):e.on("afterRemoveOldChild",function(){e.fireSequence("addNewChild")}),e.on("afterAddNewChild",function(){e.fire("beforeTransitionNewChild"),e.fireAround("aroundTransitionNewChild",function(){e.fire("transitionNewChild")})}),e.on("afterTransitionOldChild",function(){e.fireSequence("removeOldChild")}),e.on("transition",function(){e.fire("beforeTransitionOldChild"),e.fireAround("aroundTransitionOldChild",function(){e.fire("transitionOldChild")})}),e.fire("beforeTransition"),e.fireAround("aroundTransition",function(){e.fire("transition")})},cancel:function(){this.emitter.hasEvent("afterTransitionNewChild")||(this.oldChild&&this.teardownOldChild(),this.newChild&&(this.applyClass(this.newChild.el,!0),this.newChild.addToDom(this.targetEl)),this.emitter.fire("cancel"))},teardownOldChild:function(){this.oldChild.emitter.hasEvent("beforeTeardown")||this.oldChild.teardown()},addNewChild:function(){this.newChild.addToDom(this.targetEl)},ensureNewChildPrepared:function(t){this.newChild.emitter.once("afterRender",t,{immediate:!0})},transitionNewChild:function(){this.observeTransitionEnd(this.newChild.el,!0,"afterTransitionNewChild")},transitionOldChild:function(){this.oldChild.el.parentNode?this.observeTransitionEnd(this.oldChild.el,!1,"afterTransitionOldChild"):this.emitter.fire("afterTransitionOldChild")},refresh:function(t){this.oldChild&&this.oldChild.el.getBoundingClientRect(),this.newChild&&this.newChild.el.getBoundingClientRect(),t&&t()},observeTransitionEnd:function(t,n,i){var r=this.transitionEvent(t),o=r.event,a=r.duration,s=!1,u=function(){s||(s=!0,o&&e.dom.off(t,o,u),this.emitter.fire(i))}.bind(this);this.emitter.once("cancel",u),o&&e.dom.on(t,o,u),this.applyClass(t,n),o?isNaN(a)||setTimeout(u,1.1*a):setTimeout(u,this.options.backupDuration)},transitionEndEvent:function(n){var i=e.string.capitalize(n);return void 0===this._transitionEndEvent&&(this._transitionEndEvent=e.object.has(t,"on"+n+"end",!0)?n+"end":e.object.has(t,"onwebkit"+n+"end",!0)?"webkit"+i+"End":e.object.has(t,"ms"+i+"End",!0)?"ms"+i+"End":e.object.has(document.body,"ono"+n+"end",!0)||"Opera"===navigator.appName?"o"+i+"End":!1),this._transitionEndEvent},subProperty:function(t,n){return t.replace(/end/i,e.string.capitalize(n))},transitionEvent:function(t){var e=this.transitionEndEvent("transition"),n=this.transitionEndEvent("animation"),i=this._transitionEvent(e,t),r=this._transitionEvent(n,t);
return i.duration>r.duration?i:r},_transitionEvent:function(e,n){if(!e)return{duration:0};var i,r,o=this.subProperty(e,"duration"),a=this.subProperty(e,"delay"),s=t.getComputedStyle(n),u=o&&s[o]&&s[o].split(",")||["0"],c=a&&s[a]&&s[a].split(",")||["0"];return u=u.map(function(t){return parseFloat(t.toLowerCase(),10)}),c=c.map(function(t){return parseFloat(t.toLowerCase(),10)}),i=Math.max.apply(null,u),r=Math.max.apply(null,c),o&&o.indexOf("ms")<0&&(i*=1e3),a&&a.indexOf("ms")<0&&(r*=1e3),{event:e,duration:parseInt(i+r,10)}}}),e.binding=e.base.extend("binding",{init:function(t,e,n){this.view=t,this.model=e,this.options=n},setup:function(){this.normalizeOptions(),this.setupViewCallbacks(),this.setupModelCallbacks()},normalizeOptions:function(){if(!this.options.attr)throw new Error("An attr must be provided for data binding. "+JSON.stringify(this.options));var t=this.options||{},e={};e.attr=t.attr,e.sel=t.sel||'[name="'+t.attr+'"]',e.type=t.type||"auto",e.dataType=t.dataType||"default",e.eachType=t.eachType||void 0,e.trigger=t.trigger||"change keyup",e.triggerSel=t.triggerSel||e.sel,e.toModel=t.toModel||void 0===t.toModel&&"class"!==e.type,e.toView=t.toView||void 0===t.toView,e.debounce=t.debounce||!1,e.options=t.options||{},e.debounce===!0&&(e.debounce=250),this.options=e},getModelValue:function(){return this.model.get(this.options.attr)},getTypeCaster:function(t){return t=t||this.options.dataType,e.binding.typeCasters[t]||e.binding.typeCasters["default"]},getIntegration:function(t){return"auto"===this.options.type?this.determineIntegrationForElement(t):e.binding.integrations[this.options.type]||e.binding.integrations.value},determineIntegrationForElement:function(t){var n;return n=t.hasAttribute&&t.hasAttribute("data-"+this.options.attr)?"attribute":"INPUT"===t.nodeName&&"CHECKBOX"===String(t.getAttribute("type")).toUpperCase()?"check":"INPUT"===t.nodeName&&"RADIO"===String(t.getAttribute("type")).toUpperCase()?"radio":"INPUT"===t.nodeName||"SELECT"===t.nodeName||"TEXTAREA"===t.nodeName?"value":"text",e.binding.integrations[n]},setupViewCallbacks:function(){var t=this.options.toModel,n=this.options;if(t){e.object.isFunction(t)||(t=function(t,e){var n=this.getValueFromElement(t);this.applyValueToModel(n,e)}.bind(this));var i=function(e){var n=e.delegateTarget;t(n)};n.debounce&&(i=e.fn.debounce(i,n.debounce)),this.toModel=t,n.trigger.split(" ").forEach(function(t){this.view.on(t,n.triggerSel,i)}.bind(this))}},setupModelCallbacks:function(){var t=this.options.toView,n=this.options;t&&(e.object.isFunction(t)||(t=function(t){this.lastChange=t&&t.get(n.attr),this.applyValueToElements()}.bind(this)),this.toView=t,this.view.onChange(this.model,t,n.attr))},applyValueToElements:function(){if(!this.ignore)for(var t=this.view.qsa(this.options.sel),e=0;e<t.length;e++)this.getIntegration(t[e]).setValue(t[e],this)},getValueFromElement:function(t){var e=this.getIntegration(t).getValue(t,this),n=this.getTypeCaster();if(e=n(e),"array"===this.options.dataType&&this.options.eachType){var i=this.getTypeCaster(this.options.eachType);e=e.map(i)}return e},applyValueToModel:function(t,e){try{this.ignore=!0,this.model.set(this.options.attr,t,e)}finally{this.ignore=!1}},readFields:function(t){if(this.toModel)for(var e=this.view.qsa(this.options.sel),n=0;n<e.length;n++)this.toModel(e[n],t)}}),e.binding.typeCasters={array:function(t){return e.array.from(t)},"boolean":function(){var t=/^(1|true|yes|ok|on)$/;return function(e){return null==e?e:!(!e||!t.test(String(e)))}}(),number:function(t){var e=parseFloat(t,10);return isNaN(e)?null:e},integer:function(t){var e=parseInt(t,10);return isNaN(e)?null:e},string:function(t){return null==t?t:String(t)},"default":function(t){return t}},e.ns("pie.binding.integrations").attribute=function(){var t=function(t){return t.options.options.attribute||"data-"+t.options.attr};return{getValue:function(e,n){return e.getAttribute(t(n))},setValue:function(e,n){var i=n.getModelValue();return e.setAttribute(t(n),i)}}}(),e.binding.integrations["class"]=function(){var t=function(t){return t?(t=String(t),e.array.compact(e.array.map(t.split(/[\,\s]/),"trim",!0),!0)):[]};return{getValue:function(){throw new Error("class bindings can only be from the model to the view. Please declare toModel: false")},setValue:function(e,n){var i=n.options.options.className;if("_value_"!==i){var r=n.getModelValue();return i=i||n.options.attr,t(i).forEach(function(t){e.classList[r?"add":"remove"](t)}),i}var o=n.lastChange;return o&&(o.oldValue&&t(o.oldValue).forEach(function(t){e.classList.remove(t)}),o.value)?(t(o.value).forEach(function(t){e.classList.add(t)}),o.value):void 0}}}(),e.binding.integrations.value={getValue:function(t){return t.value},setValue:function(t,e){var n=e.getModelValue();return null==n&&(n=""),t.value=n}},e.binding.integrations.check=function(){var t=function(t,n){return t?(n=String(n),e.array.indexOf(t,function(t){return String(t)===n})):-1};return{getValue:function(n,i){if("array"===i.options.dataType){var r,o=e.array.from(i.getModelValue());return r=t(o,n.value),n.checked&&0>r?(o=e.array.dup(o),o.push(n.value)):!n.checked&&r>=0&&(o=e.array.dup(o),o.splice(r,1)),o}return"boolean"===i.options.dataType?!!n.checked:n.checked?n.value:null},setValue:function(e,n){var i=n.getModelValue(),r=e.value;if("array"===n.options.dataType){var o=t(i,r);return e.checked=!!~o}var a=n.getTypeCaster(n.options.dataType);return e.checked=a(r)===a(i)}}}(),e.binding.integrations.radio={getValue:function(t,e){var n=e.getModelValue();return t.checked?t.value:n},setValue:function(t,e){var n=e.getModelValue(),i=t.value,r=e.getTypeCaster();return t.checked=r(i)===r(n)}},e.binding.integrations.text={getValue:function(t){return t.textContent},setValue:function(t,e){var n=e.getModelValue();return null==n&&(n=""),t.textContent=n}},e.binding.integrations.html={getValue:function(t){return t.innerHTML},setValue:function(t,e){var n=e.getModelValue();return null==n&&(n=""),t.innerHTML=n}},e.VERSION="0.0.20150508.1","function"==typeof define&&define.amd?define(function(){return e}):t.pie=e}(this);