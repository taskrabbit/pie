sudo.templateSettings={evaluate:/\[%([\s\S]+?)%\]/g,interpolate:/\[%=([\s\S]+?)%\]/g,escape:/\[%-([\s\S]+?)%\]/g},window.pie={array:{},date:{},func:{},math:{},object:{},string:{},h:{},t:{},m:{},services:{}},pie.array.compact=function(e,t){return e.filter(function(e){return t?!!e:void 0!==e&&null!==e})},pie.array.dup=function(e){return e.slice(0)},pie.array.remove=function(e,t){for(var r;(r=e.indexOf(t))>=0;)e.splice(r,1);return e},pie.array.sum=function(e){var t=0;return e.forEach(function(e){t+=parseFloat(e)}),t},pie.array.avg=function(e){var t=pie.array.sum(e),r=e.length;return t/r},pie.array.subtract=function(e,t){return e.filter(function(e){return t.indexOf(e)<0})},pie.array.intersect=function(e,t){return e.filter(function(e){return-1!==t.indexOf(e)})},pie.array.last=function(e){return e&&e.length?e[e.length-1]:void 0},pie.array.from=function(e){return Array.isArray(e)?e:pie.array.compact([e],!1)},pie.array.grep=function(e,t){return e.filter(function(e){return t.test(e.toString())})},pie.array.flatten=function(e,t){return t=t||[],Array.isArray(e)?e.forEach(function(e){pie.array.flatten(e,t)}):t.push(e),t},pie.array.map=function(e,t,r){var i,n=[];return i="function"!=typeof t?function(e){var i=e[t];return r&&"function"==typeof i?i.apply(e):i}:t,e.forEach(function(e){n.push(i(e))}),n},pie.array.sortBy=function(e,t){var r,i;return e.sort(function(e,n){return r=pie.func.valueFrom(e[t]),i=pie.func.valueFrom(n[t]),r===i?0:i>r?-1:1})},pie.array.detect=function(e,t){for(var r=0,i=e.length;i>r;r++)if("function"==typeof t){if(t(e[r]))return e[r]}else if(e[r]&&pie.func.valueFrom(e[r][t]))return e[r]},pie.array.args=function(e){return Array.prototype.slice.call(e)},pie.array.uniq=function(e){return e.filter(function(t,r){return e.indexOf(t)===r})},pie.array.toSentence=function(e){return e.length?(e.length>2&&(e=[e.slice(0,e.length-1).join(", "),e.slice(e.length-1)]),e.join(" and ")):void 0},pie.date.dateFromISO=function(e){if(!e)return null;var t=e.split("T")[0].split("-");return new Date(t[0],t[1]-1,t[2])},pie.date.timeFromISO=function(e){return e?e.indexOf("T")<0?pie.date.dateFromISO(e):new Date(e):null},pie.func.debounce=function(e,t,r){var i;return function(){var n=this,o=arguments,a=function(){i=null,r||e.apply(n,o)},s=r&&!i;clearTimeout(i),i=setTimeout(a,t),s&&e.apply(n,o)}},pie.func.valueFrom=function(e){return"function"==typeof e?e():e},pie.math.precision=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},pie.object.slice=function(){var e={},t=1,r=arguments,i=r[0];for(Array.isArray(r[1])&&(r=r[1],t=0);t<r.length;t++)i.hasOwnProperty(r[t])&&(e[r[t]]=i[r[t]]);return e},pie.object.except=function(){var e={},t=pie.array.args(arguments),r=t[0];return t=pie.array.flatten(t.splice(1)),Object.keys(r).forEach(function(i){t.indexOf(i)<0&&(e[i]=r[i])}),e},pie.object.compact=function(e,t){var r=pie.h.extend({},e);return Object.keys(r).forEach(function(e){(void 0===r[e]||null===r[e]||t&&0===r[e].toString().length)&&delete r[e]}),r},pie.object.values=function(e){var t=[];return Object.keys(e).forEach(function(r){t.push(e[r])}),t},pie.object.forEach=function(e,t){Object.keys(e).forEach(function(r){t(r,e[r])})},pie.string.expand=function(e,t){return t=t||{},e.replace(/\%\{(.+?)\}/g,function(e,r){return t[r]})},pie.string.change=function(){var e=Array.args(arguments),t=e[0];return e=e.slice(1),e.forEach(function(e){t=pie.string[e](t)}),t},pie.string.urlConcat=function(){var e=pie.array.compact(pie.array.args(arguments),!0),t=e.shift(),r=e.join("&");return r.length?(t.indexOf("?")<0&&(t+="?"),0===r.indexOf("?")&&(r=r.replace("?","&")),t+=r,t=t.replace("?&","?").replace("&&","&").replace("??","?"),t.indexOf("?")===t.length-1&&(t=t.substr(0,t.length-1)),t):t},pie.string.escape=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},pie.string.underscore=function(e){return e.replace(/([a-z])([A-Z])/g,function(e,t,r){return t+"_"+r.toLowerCase()}).toLowerCase()},pie.string.humanize=function(e){return e.replace(/_id$/,"").replace(/([a-z][A-Z]|[a-z]_[a-z])/g,function(e,t){return t[0]+" "+t[t.length-1]})},pie.string.titleize=function(e){return e.replace(/(^| )([a-z])/g,function(e,t,r){return t+r.toUpperCase()})},pie.string.pluralize=function(e){return/ss$/i.test(e)?e+"es":/s$/i.test(e)?e:/[a-z]$/i.test(e)?e+"s":e},pie.string.capitalize=function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},pie.string.lowerize=function(e){return e.charAt(0).toLowerCase()+e.slice(1)},pie.string.modularize=function(e){return e.replace(/([^_])_([^_])/g,function(e,t,r){return t+r.toUpperCase()})},pie.h.createElement=$.createElement,pie.h.deserialize=$.deserialize,pie.h.extend=$.extend,pie.h.getPath=sudo.getPath,pie.h.serialize=$.serialize,pie.h.template=sudo.template,pie.m.observable=sudo.extensions.observable,pie.baseView=function(e,t){sudo.View.call(this,e,t||{}),this.changeCallbacks=[]},pie.baseView.prototype=Object.create(sudo.View.prototype),pie.baseView.constructor=pie.baseView,pie.baseView.prototype.eventNamespace=function(){return this.role+this.uid},pie.baseView.prototype.on=function(e,t,r){var i=this.eventNamespace(),n=function(e){return e.namespace===i?r.apply(this,arguments):void 0};return e.split(" ").forEach(function(e){e+="."+i,$(this.el).on(e,n,t)}.bind(this)),this},pie.baseView.prototype.onChange=function(){var e,t=arguments[0],r=arguments[1],i=pie.array.args(arguments).slice(2);"observe"in t||pie.h.extend(t,pie.m.observable),e=function(e){(!i.length||i.indexOf(e.name)>=0)&&e.oldValue!==e.object[e.name]&&r(e)},this.changeCallbacks.push([t,e]),t.observe(e)},pie.baseView.prototype.parseFields=function(){var e,t,r={},i=arguments[0],n=0;for("string"==typeof i?i=this.el:n++;n<arguments.length;n++)e=arguments[n],t=i.querySelector('[name="'+e+'"]:not([disabled])'),t&&sudo.setPath(e,t.value,r);return r},pie.baseView.prototype.addedToParent=function(){return this},pie.baseView.prototype.removedFromParent=function(){return this._unobserveEvents_(),this._unobserveChangeCallbacks_(),this.removeChildren(),this},pie.baseView.prototype._unobserveEvents_=function(){$(this.el).off("*."+this.eventNamespace()),$(document.body).off("*."+this.eventNamespace())},pie.baseView.prototype._unobserveChangeCallbacks_=function(){for(var e;this.changeCallbacks.length;)e=this.changeCallbacks.pop(),e[0].unobserve(e[1])},pie.baseView.prototype.navigationUpdated=function(){this.children.forEach(function(e){"navigationUpdated"in e&&e.navigationUpdated()})},pie.baseView.prototype.loadingStyle=function(e){void 0===e&&(e=!0),this._loadingStyle(e)},pie.baseView.prototype.removeLoadingStyle=function(){this._loadingStyle(!1)},pie.baseView.prototype._loadingStyle=function(e){this.el.classList[e?"add":"remove"]("loading"),$(this.qsa(".submit-container button.btn-primary, .btn-loading, .btn-loadable")).all(e?"classList.add":"classList.remove","btn-loading").all(e?"setAttribute":"removeAttribute","disabled","disabled")},pie.baseView.extend=function(){var e=pie.array.args(arguments),t=pie.h.extend.apply(null,e),r=["addedToParent","removedFromParent","navigationUpdated"];return r.forEach(function(e){if(e in t){var r=t[e];t[e]=function(t){var i=r.call(this,t);return this.base(e,t),i}}}),pie.h.extend(Object.create(pie.baseView.prototype),t)},pie.services.ajax=function(e){this.app=e,this.defaultAjaxOptions={}},pie.services.ajax.prototype._defaultAjaxOptions=function(){return $.extend({},this.defaultAjaxOptions,{dataType:"json",type:"GET",error:this.app.errorHandler.handleXhrError})},pie.services.ajax.prototype.ajax=function(e){if(e=pie.object.compact(e),e=pie.h.extend({},this._defaultAjaxOptions(),e),e.extraError){var t=e.error;e.error=function(r){t(r),e.extraError(r)}}var r,i=this.app,n=new XMLHttpRequest,o=e.url;return o="GET"===e.type&&e.data?i.router.path(o,e.data):i.router.path(o),e.progress?n.addEventListener("progress",e.progress,!1):e.uploadProgress&&n.upload.addEventListener("progress",e.uploadProgress,!1),n.open(e.type,o,!0),n.setRequestHeader("Accept","application/json"),n.setRequestHeader("Content-Type","application/json"),this._applyCsrfToken(n),n.onload=function(){e.tracker&&e.tracker(this);try{this.data=this.response.trim().length?JSON.parse(this.response):{}}catch(t){i.debug("could not parse JSON response: "+t),this.data={}}this.status>=200&&this.status<300||304===this.status?(e.dataSuccess&&e.dataSuccess(this.data),e.success&&e.success(this.data,this)):e.error&&e.error(this),e.complete&&e.complete(this)},"GET"!==e.type&&(r=e.data?"string"==typeof e.data?e.data:JSON.stringify(pie.object.compact(e.data)):void 0),n.send(r),n},pie.services.ajax.prototype.get=function(e){return this.ajax(e)},pie.services.ajax.prototype.post=function(e){return e=pie.h.extend({type:"POST"},e),this.ajax(e)},pie.services.ajax.prototype.put=function(e){return this.post($.extend({type:"PUT"},e))},pie.services.ajax.prototype.del=function(e){return this.post($.extend({type:"DELETE"},e))},pie.services.ajax.prototype._applyCsrfToken=function(e){var t=document.querySelector('meta[name="csrf-token"]'),r=t?t.getAttribute("content"):null;r&&e.setRequestHeader("X-CSRF-Token",r)},pie.services.errorHandler=function(e){this.app=e,this.responseCodeHandlers={}},pie.services.errorHandler.prototype.data=function(e){return e.data=e.data||(e.status?JSON.parse(e.response):{})},pie.services.errorHandler.prototype.errorMessagesFromRequest=function(e){var t=this.data(e),r=Array.map(t.errors||[],"message"),i=this.app.i18n.t("app.errors."+e.status,{"default":r});return this.app.debug(r),i},pie.services.errorHandler.prototype.handleXhrError=function(e){var t=this.responseCodeHandlers[e.status.toString()];t?t.call(e,e):this.notifyErrors(e)},pie.services.errorHandler.prototype.notifyErrors=function(e){var t=this.app.notifier,r=this.errorMessagesFromRequest(e);r.length&&(t.clear(),setTimeout(function(){t.clear("error"),t.notify(r,"error",1e4)},100))},pie.services.errorHandler.prototype.registerHandler=function(e,t){this.responseCodeHandlers[e.toString()]=t},pie.services.errorHandler.prototype.reportError=function(e,t){t=t||{},t.prefix&&"message"in e&&(e.message=t.prefix+" "+e.message),t.prefix&&"name"in e&&(e.name=t.prefix+" "+e.name),this._reportError(e,t)},pie.services.errorHandler.prototype._reportError=function(e){this.app.debug(e)},pie.services.i18n=function(e){this.translations={},this.app=e},pie.services.i18n.prototype._ampm=function(e){return e>=12?"pm":"am"},pie.services.i18n.prototype._countAlias={0:"zero",1:"one"},pie.services.i18n.prototype._dayName=function(e){return this.t("app.date.day_names."+e)},pie.services.i18n.prototype._hour=function(e){return e>12&&(e-=12),e||(e+=12),e},pie.services.i18n.prototype._isoDate=function(e,t){return t&&(e=this._utc(e)),e.getFullYear()+"-"+this._space(e.getMonth()+1,2,"0")+"-"+this._space(e.getDate(),2,"0")},pie.services.i18n.prototype._isoTime=function(e){return e=this._utc(e),this._space(e.getHours(),2,"0")+":"+this._space(e.getMinutes(),2,"0")+":"+this._space(e.getSeconds(),2,"0")+"."+this._space(e.getMilliseconds(),3,"0")+"Z"},pie.services.i18n.prototype._monthName=function(e){return this.t("app.date.month_names."+e)},pie.services.i18n.prototype._normalizedDate=function(e){return"string"==typeof e&&(e=pie.date.timeFromISO(e)),e},pie.services.i18n.prototype._shortDayName=function(e){return this.t("app.date.short_day_names."+e)},pie.services.i18n.prototype._shortMonthName=function(e){return this.t("app.date.short_month_names."+e)},pie.services.i18n.prototype._space=function(e,t,r){var i="",n=t-e.toString().length;for(void 0===r&&(r=" ");n>0;)i+=r,n-=1;return i+e.toString()},pie.services.i18n.prototype._timezoneAbbr=function(e){var t=e&&e.toString();return t&&t.split(/\((.*)\)/)[1]},pie.services.i18n.prototype._utc=function(e){var t=new Date(e.getTime());return t.setMinutes(t.getMinutes()+t.getTimezoneOffset()),t},pie.services.i18n.prototype.load=function(){for(var e,t=0;t<arguments.length;t++)e=arguments[t],pie.h.extend(this.translations,e)},pie.services.i18n.prototype.t=function(e,t){var r,i=pie.h.getPath(e,this.translations);return t&&t.hasOwnProperty("count")&&"object"==typeof i&&(r=(t.count||0).toString(),r=this._countAlias[r]||"other",i=void 0===i[r]?i.other:i[r]),i?"string"==typeof i?-1===i.indexOf("%{")?i:pie.string.expand(i,t):i:t&&t.hasOwnProperty("default")?t.default:(this.app.debug("Translation not found: "+e),"")},pie.services.i18n.prototype.timeago=function(e){e=this._normalizedDate(e).getTime()/1e3;var t,r=(new Date).getTime()/1e3,i=r-e;return 60>i?this.t("app.timeago.now"):3600>i?(t=Math.floor(i/60),this.t("app.timeago.minutes",{count:t})):86400>i?(t=Math.floor(i/3600),this.t("app.timeago.hours",{count:t})):604800>i?(t=Math.floor(i/86400),this.t("app.timeago.days",{count:t})):2592e3>i?(t=Math.floor(i/604800),this.t("app.timeago.weeks",{count:t})):31594125>i?(t=Math.floor(i/2629800),this.t("app.timeago.months",{count:t})):(t=Math.floor(i/86400*365.25),this.t("app.timeago.years",{count:t}))},pie.services.i18n.prototype.strftime=function(e,t){e=this._normalizedDate(e);var r=e.getDay(),i=e.getDate(),n=e.getFullYear(),o=e.getMonth()+1,a=e.getHours(),s=this._hour(a),p=this.ampm(a),c=e.getSeconds(),u=e.getMinutes(),h=e.getTimezoneOffset(),l=Math.floor(Math.abs(h/60)),f=Math.abs(h)-60*l,d=(h>0?"-":"+")+this._pad(l,2)+this._pad(f,2);return t=t.replace("%a",this._shortDayName(r)).replace("%A",this._dayName(r)).replace("%b",this._shortMonthName(o)).replace("%d",this._pad(i)).replace("%e",i).replace("%-d",i).replace("%H",this._pad(a)).replace("%k",a).replace("%I",this._pad(s)).replace("%l",s).replace("%m",this._pad(o)).replace("%-m",o).replace("%M",this._pad(u)).replace("%p",p.toUpperCase()).replace("%P",p).replace("%S",this._pad(c)).replace("%-S",c).replace("%w",r).replace("%y",this._pad(n)).replace("%-y",this._pad(n).replace(/^0+/,"")).replace("%Y",n).replace("%z",d).replace("%Z",this._timezoneAbbr(e))},pie.services.i18n.prototype.l=pie.services.i18n.prototype.strftime,pie.services.notifier=function(e){this.app=e,this.notifications={},this.construct()},pie.services.notifier.prototype=pie.baseView.extend({addedToParent:function(){this.on("click",".page-alert",this.handleAlertClick.bind(this))},clear:function(e){if(e)for(var t=this.notifications[e]||[];t.length;)this.remove(t[t.length-1]);else for(;this.el.childNodes.length;)this.remove(this.el.childNodes[0])},notify:function(e,t,r){t=t||"message",r=this.getAutoCloseTimeout(r),e=pie.array.from(e);var i=this.app.template("alert",{type:t,messages:e});i=pie.h.createElement(i).q[0],this.notifications[t]=this.notifications[t]||[],this.notifications[t].push(i),i._pieNotificationType=t,this.el.insertBefore(i,this.el.firstElementChild),r&&setTimeout(function(){this.remove(i)}.bind(this),r)},getAutoCloseTimeout:function(e){return void 0===e&&(e=!0),e&&"number"!=typeof e&&(e=7e3),e},remove:function(e){var t=e._pieNotificationType;t&&pie.array.remove(this.notifications[t]||[],e),$(e).remove()},handleAlertClick:function(e){this.remove(e.delegateTarget),e.preventDefault()}}),pie.services.router=function(e){this.app=e,this.routes={},this.namedRoutes={}},pie.services.router.prototype.changedUrl=function(e){var t=this.app.parsedUrl;return this.router.path(t.name||t.path,pie.h.extend({},t.interpolations,t.query,e))},pie.services.router.prototype.route=function(e,t){t=t||{},delete this._routeKeys,pie.object.forEach(e,function(e,r){"object"==typeof r?(this.routes[e]=pie.h.extend({},t,r),r.hasOwnProperty("name")&&(this.namedRoutes[r.name]=e)):this.namedRoutes[e]=r}.bind(this))},pie.services.router.prototype.path=function(e,t,r){var i,n,o=this.namedRoutes[e],a="string"==typeof o?o:e,s=[];return t=t||{},a=a.replace(/\:([a-zA-Z0-9_]+)/g,function(e,r){if(s.push(r),void 0===t[r]||null===t[r]||0===t[r].toString().length)throw new Error("[PIE] missing route interpolation: "+e);return t[r]}),0!==a.indexOf("/")&&(a="/"+a),a.indexOf("#")===a.length-1&&(a=a.substr(0,a.length-1)),n=pie.object.except(t,s),i=pie.h.serialize(pie.object.compact(n,!0)),!r&&i.length&&(a=pie.string.urlConcat(a,i)),a},pie.services.router.prototype.routeKeys=function(){if(this._routeKeys)return this._routeKeys;this._routeKeys=Object.keys(this.routes);var e,t,r,i=[];return this._routeKeys.sort(function(n,o){return e=(n.match(/:/g)||i).length,t=(o.match(/:/g)||i).length,r=e-t,r=r||o.length-n.length,r=r||(t>e?1:e>t?-1:0)}),this._routeKeys},pie.services.router.prototype.parseUrl=function(e){var t,r,i,n,o,a,s,p,c,u=this.routeKeys(),h=0;if(c=e.split("?"),e=c.shift(),a=c.join("&")||"",e.length>1&&"/"===e[e.length-1]&&(e=e.slice(0,-1)),i=this.routes[e],s={},n=e.split("/"),i)i=pie.h.extend({routeKey:e},i);else for(;h<u.length&&!i;)if(r=u[h],"object"==typeof this.routes[r]){if(this.routes[r].regex=this.routes[r].regex||new RegExp("^"+r.replace(/(:[^\/]+)/g,"([^\\/]+)")+"$"),this.routes[r].regex.test(e))for(i=pie.h.extend({routeKey:r},this.routes[r]),o=r.split("/"),t=0;t<o.length;t++)/^:/.test(o[t])&&(s[o[t].replace(/^:/,"")]=n[t],i[o[t]]=n[t]);h++}else h++;return a=pie.h.deserialize(a),p=pie.array.compact([e,pie.h.serialize(a)],!0).join("?"),pie.h.extend({interpolations:s,path:e,query:a,fullPath:p},i)},pie.app=function(e){sudo.Container.call(this),this.options=pie.h.extend({uiTarget:"body",viewNamespace:"lib.views",notificationUiTarget:".notification-container"},e);var t=function(e,t){var r=this.options[e]||t;return new r(this)}.bind(this);this.i18n=t("i18n",pie.services.i18n),this.addChild(this.i18n,"i18n"),this.ajax=t("ajax",pie.services.ajax),this.addChild(this.ajax,"ajax"),this.notifier=t("notifier",pie.services.notifier),this.addChild(this.notifier,"notifier"),this.errorHandler=t("errorHandler",pie.services.errorHandler),this.addChild(this.errorHandler,"errorHandler"),this.router=t("router",pie.services.router),this.addChild(this.router,"router"),this.navigator=new sudo.Navigator({root:"/",useHashChange:!1}),this.models={},this._templates={},this.parsedUrl={},this.eventCallbacks={},this.triggeredEvents=[],pie.h.extend(this.navigator,pie.m.observable),this.navigator.observe(this.navigationChanged.bind(this)),this.on("beforeStart",this.showStoredNotifications.bind(this)),this.on("beforeStart",this.setupSinglePageLinks.bind(this)),this.on("beforeStart",this.setupNotifier.bind(this)),document.addEventListener("DOMContentLoaded",this.start.bind(this))},pie.app.prototype=Object.create(sudo.Container.prototype),pie.app.constructor=pie.app,pie.app.prototype.confirm=function(e){window.confirm(e.text)?e.success&&e.success():e.failure&&e.failure()},pie.app.prototype.debug=function(e){"production"!==this.env&&console&&console.log&&console.log("[PIE] "+e)},pie.app.prototype.go=function(){var e,t,r,i,n=pie.array.args(arguments);e=n.shift(),"string"==typeof n[0]&&0===n[0].indexOf("?")?(e=this.router.path(e),i=n.shift(),e=pie.string.urlConcat(this.router.path(e),i)):e="object"==typeof n[0]?this.router.path(e,n.shift()):this.router.path.apply(this.router,pie.array.from(e)),(n[0]===!0||n[0]===!1)&&(r=n.shift()),t=n,this.router.parseUrl(e).hasOwnProperty("view")?(this.navigator.go(e,r),t&&t.length&&this.notifier.notify.apply(this.notifier,t)):(t&&t.length&&this.store(this.notifier.storageKey,t),window.location.href=e)},pie.app.prototype.goBack=function(){window.history.back()},pie.app.prototype.handleSinglePageLinkClick=function(e){if(!e.delegateTarget.getAttribute("target")&&!e.ctrlKey&&!e.metaKey){var t=e.delegateTarget.getAttribute("href");t&&"#"!==t&&(e.preventDefault(),this.go(t))}},pie.app.prototype.navigationChanged=function(){var e=document.querySelector(this.options.uiTarget),t=this.getChild("currentView");if(this.previousUrl=this.parsedUrl,this.parsedUrl=this.router.parseUrl(this.navigator.getUrl()),this.previousUrl!==this.parsedUrl&&this.trigger("urlChanged"),this.parsedUrl.view){if(t&&t._pieName===this.parsedUrl.view)return void("navigationUpdated"in t&&t.navigationUpdated());t&&(this.removeChild(t),t.el.parentNode&&t.el.parentNode.removeChild(t.el),this.on("oldViewRemoved")),this.notifier.clear();var r,i=pie.h.getPath(this.viewNamespace+"."+this.parsedUrl.view,window);r=new i(this),r._pieName=this.parsedUrl.view,this.addChild(r,"currentView"),e.appendChild(r.el),this.models={},window.scrollTo(0,0),this.trigger("newViewLoaded")}},pie.app.prototype.on=function(e,t,r){!r&&this.triggeredEvents.indexOf(e)>=0?t():(this.eventCallbacks[e]=this.eventCallbacks[e]||[],this.eventCallbacks[e].push(t))},pie.app.prototype.refresh=function(){var e=this.getChild("currentView");e._pieName="__remove__",this.navigationChanged()},pie.app.prototype.retrieve=function(e,t){var r,i;try{r=window.localStorage.getItem(e),i=r?JSON.parse(r):void 0}catch(n){this.errorHandler.reportError(n,{prefix:"[caught] app#retrieve/getItem:"})}try{(t||void 0===t)&&window.localStorage.removeItem(e)}catch(n){this.errorHandler.reportError(n,{prefix:"[caught] app#retrieve/removeItem:"})}return i},pie.app.prototype.role="app",pie.app.prototype.setupNotifier=function(){var e=document.querySelector(this.options.notificationUiTarget);e&&e.appendChild(this.getChild("notifier").el)},pie.app.prototype.setupSinglePageLinks=function(){$(document.body).on("click",this.handleSinglePageLinkClick.bind(this),"a[href]")},pie.app.prototype.showStoredNotifications=function(){var e,t=this.retrieve(this.notifier.storageKey);t&&(e=JSON.parse(t),this.on("afterStart",function(){this.notifier.notify.apply(this.notifier,e)}.bind(this)))},pie.app.prototype.start=function(){this.navigator.start(),this.trigger("beforeStart");var e=this.navigator.get("fragment");this.navigator.data.fragment=null,this.navigator.set("fragment",e),this.started=!0,this.trigger("afterStart")},pie.app.prototype.store=function(e,t){try{window.localStorage.setItem(e,JSON.stringify(t))}catch(r){this.errorHandler.reportError(r,{prefix:"[caught] app#store:"})}},pie.app.prototype.template=function(e,t){if(!this._templates[e]){var r=document.querySelector('script[id="'+e+'"][type="text/pie-template"]');if(!r)throw"[PIE] Unknown template error: "+e;this.debug("Compiling and storing template: "+e),this._templates[e]=sudo.template(r.textContent)}return t=t||{},this._templates[e](t)},pie.app.prototype.trigger=function(e){this.triggeredEvents.indexOf(e)<0&&this.triggeredEvents.push(e),(this.eventCallbacks[e]||[]).forEach(function(e){e()})};